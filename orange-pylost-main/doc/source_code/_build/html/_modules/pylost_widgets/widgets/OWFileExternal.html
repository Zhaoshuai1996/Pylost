
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pylost_widgets.widgets.OWFileExternal &#8212; pylost_widgets  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for pylost_widgets.widgets.OWFileExternal</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">OWFileExternal is copied from orange native OWFile and adapted to pylost use</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">catch_warnings</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">Orange.data</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">Orange.data.io</span> <span class="kn">import</span> <span class="n">class_from_qualified_name</span><span class="p">,</span> <span class="n">FileFormat</span>
<span class="kn">from</span> <span class="nn">Orange.widgets</span> <span class="kn">import</span> <span class="n">gui</span><span class="p">,</span> <span class="n">widget</span>
<span class="kn">from</span> <span class="nn">Orange.widgets.utils.signals</span> <span class="kn">import</span> <span class="n">Output</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtWidgets</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="kn">import</span> <span class="n">uic</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="n">QThread</span><span class="p">,</span> <span class="n">pyqtSlot</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QSize</span><span class="p">,</span> <span class="n">QPoint</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtGui</span> <span class="kn">import</span> <span class="n">QPainter</span><span class="p">,</span> <span class="n">QPen</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> <span class="n">QGridLayout</span><span class="p">,</span> <span class="n">QDialog</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="kn">import</span> \
    <span class="n">QStyle</span><span class="p">,</span> <span class="n">QSizePolicy</span> <span class="k">as</span> <span class="n">Policy</span><span class="p">,</span> <span class="n">QAbstractItemView</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QTabWidget</span><span class="p">,</span> <span class="n">QLineEdit</span>
<span class="kn">from</span> <span class="nn">astropy.units</span> <span class="kn">import</span> <span class="n">Quantity</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">orangewidget.settings</span> <span class="kn">import</span> <span class="n">Setting</span>
<span class="kn">from</span> <span class="nn">orangewidget.utils.filedialogs</span> <span class="kn">import</span> <span class="n">RecentPathsWComboMixin</span><span class="p">,</span> <span class="n">RecentPath</span><span class="p">,</span> <span class="n">open_filename_dialog</span>
<span class="kn">from</span> <span class="nn">orangewidget.utils.signals</span> <span class="kn">import</span> <span class="n">Input</span>
<span class="kn">from</span> <span class="nn">orangewidget.widget</span> <span class="kn">import</span> <span class="n">Msg</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>

<span class="kn">from</span> <span class="nn">pylost_widgets.config</span> <span class="kn">import</span> <span class="n">config_params</span>
<span class="kn">from</span> <span class="nn">pylost_widgets.util</span> <span class="kn">import</span> <span class="n">MetrologyData</span>
<span class="kn">from</span> <span class="nn">pylost_widgets.util.DataViewerFrameOrange</span> <span class="kn">import</span> <span class="n">DataViewerFrameOrange</span>
<span class="kn">from</span> <span class="nn">pylost_widgets.util.DictionaryTree</span> <span class="kn">import</span> <span class="n">DictionaryTreeWidget</span>
<span class="kn">from</span> <span class="nn">pylost_widgets.util.FileSeqLoader</span> <span class="kn">import</span> <span class="n">FileSeqLoader</span>
<span class="kn">from</span> <span class="nn">pylost_widgets.util.Task</span> <span class="kn">import</span> <span class="n">Task</span>
<span class="kn">from</span> <span class="nn">pylost_widgets.util.ow_filereaders</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylost_widgets.scripts.file_formats</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylost_widgets.util.resource_path</span> <span class="kn">import</span> <span class="n">resource_path</span>
<span class="kn">from</span> <span class="nn">pylost_widgets.util.util_functions</span> <span class="kn">import</span> <span class="n">get_import_data_names</span><span class="p">,</span> <span class="n">copy_items</span><span class="p">,</span> <span class="n">walk_dict</span><span class="p">,</span> <span class="n">fill_dict</span><span class="p">,</span> \
    <span class="n">questionMsgAdv</span><span class="p">,</span> <span class="n">get_default_data_names</span><span class="p">,</span> <span class="n">get_dict_item</span><span class="p">,</span> <span class="n">open_multifile_dialog</span><span class="p">,</span> <span class="n">walk_dict_by_type</span><span class="p">,</span> <span class="n">questionMsg</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="n">qtCreatorFile</span> <span class="o">=</span> <span class="n">resource_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;gui&quot;</span><span class="p">,</span> <span class="s2">&quot;dialog_import.ui&quot;</span><span class="p">))</span> <span class="c1"># Enter file here.</span>
<span class="n">UI_import</span><span class="p">,</span> <span class="n">QtBaseClass</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUiType</span><span class="p">(</span><span class="n">qtCreatorFile</span><span class="p">)</span>
<span class="n">qtaddnl</span> <span class="o">=</span> <span class="n">resource_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;gui&quot;</span><span class="p">,</span> <span class="s2">&quot;dialog_import_additional_data.ui&quot;</span><span class="p">))</span> <span class="c1"># Enter file here.</span>
<span class="n">UI_import_addnl</span><span class="p">,</span> <span class="n">QtBaseClass</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUiType</span><span class="p">(</span><span class="n">qtaddnl</span><span class="p">)</span>
<span class="n">qtmd</span> <span class="o">=</span> <span class="n">resource_path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;gui&quot;</span><span class="p">,</span> <span class="s2">&quot;dialog_metrology_data.ui&quot;</span><span class="p">))</span> <span class="c1"># Enter file here.</span>
<span class="n">UI_met_data</span><span class="p">,</span> <span class="n">QtBaseClass</span> <span class="o">=</span> <span class="n">uic</span><span class="o">.</span><span class="n">loadUiType</span><span class="p">(</span><span class="n">qtmd</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">concurrent.futures</span>
<span class="kn">from</span> <span class="nn">Orange.widgets.utils.concurrent</span> <span class="kn">import</span> <span class="n">ThreadExecutor</span><span class="p">,</span> <span class="n">FutureWatcher</span><span class="p">,</span> <span class="n">methodinvoke</span>

<span class="c1"># Import user file format script paths</span>
<span class="kn">from</span> <span class="nn">pylost_widgets.util.util_scripts</span> <span class="kn">import</span> <span class="n">import_paths</span>
<span class="n">import_paths</span><span class="p">(</span><span class="n">param_name</span><span class="o">=</span><span class="s1">&#39;FILE_FORMAT_PATH&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="OWFileExternal"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal">[docs]</a><span class="k">class</span> <span class="nc">OWFileExternal</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">OWWidget</span><span class="p">,</span> <span class="n">RecentPathsWComboMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;File loader widget&quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Data (File)&#39;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s1">&#39;Loads data from external file&#39;</span>
    <span class="n">icon</span> <span class="o">=</span> <span class="s2">&quot;../icons/import.svg&quot;</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mi">1</span>

<div class="viewcode-block" id="OWFileExternal.Inputs"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.Inputs">[docs]</a>    <span class="k">class</span> <span class="nc">Inputs</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">auto_summary</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="OWFileExternal.Outputs"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.Outputs">[docs]</a>    <span class="k">class</span> <span class="nc">Outputs</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">Output</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">auto_summary</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

    <span class="n">want_main_area</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">SEARCH_PATHS</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#TODO: set default paths</span>

    <span class="n">recent_paths</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">RecentPath</span><span class="p">]</span>

    <span class="n">recent_paths</span> <span class="o">=</span> <span class="n">Setting</span><span class="p">([])</span>
    <span class="n">enable_multiselect</span> <span class="o">=</span> <span class="n">Setting</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<div class="viewcode-block" id="OWFileExternal.Information"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.Information">[docs]</a>    <span class="k">class</span> <span class="nc">Information</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">OWWidget</span><span class="o">.</span><span class="n">Information</span><span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">Msg</span><span class="p">(</span><span class="s2">&quot;Info:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OWFileExternal.Warning"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.Warning">[docs]</a>    <span class="k">class</span> <span class="nc">Warning</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">OWWidget</span><span class="o">.</span><span class="n">Warning</span><span class="p">):</span>
        <span class="n">file_too_big</span> <span class="o">=</span> <span class="n">Msg</span><span class="p">(</span><span class="s2">&quot;The file is too large to load automatically. Press Reload to load.&quot;</span><span class="p">)</span>
        <span class="n">load_warning</span> <span class="o">=</span> <span class="n">Msg</span><span class="p">(</span><span class="s2">&quot;Read warning:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OWFileExternal.Error"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.Error">[docs]</a>    <span class="k">class</span> <span class="nc">Error</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">OWWidget</span><span class="o">.</span><span class="n">Error</span><span class="p">):</span>
        <span class="n">incorrect_input</span> <span class="o">=</span> <span class="n">Msg</span><span class="p">(</span><span class="s2">&quot;Invalid input data. Data type of input can only be in (dict, tuple, np.ndarray, Table(Orange)).&quot;</span><span class="p">)</span>
        <span class="n">file_not_found</span> <span class="o">=</span> <span class="n">Msg</span><span class="p">(</span><span class="s2">&quot;File not found.&quot;</span><span class="p">)</span>
        <span class="n">missing_reader</span> <span class="o">=</span> <span class="n">Msg</span><span class="p">(</span><span class="s2">&quot;Missing reader.&quot;</span><span class="p">)</span>
        <span class="n">unknown</span> <span class="o">=</span> <span class="n">Msg</span><span class="p">(</span><span class="s2">&quot;Read error:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OWFileExternal.NoFileSelected"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.NoFileSelected">[docs]</a>    <span class="k">class</span> <span class="nc">NoFileSelected</span><span class="p">:</span>
        <span class="k">pass</span></div>

    <span class="k">def</span>  <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize GUI for file tree viewer and data visualizer. Two file viewers are used one for loaded data (input),</span>
<span class="sd">        and second (output) for data formatted to orange-pylost compatible mode (e.g. using MetrologyData)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="n">RecentPathsWComboMixin</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename_seq</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_DATA_NAMES</span> <span class="o">=</span> <span class="n">get_default_data_names</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_axis_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Motor&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_dim_detector</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_path</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_path</span><span class="p">()):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_path</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">controlArea</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>

        <span class="n">layout</span> <span class="o">=</span> <span class="n">QGridLayout</span><span class="p">()</span>
        <span class="n">gui</span><span class="o">.</span><span class="n">widgetBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controlArea</span><span class="p">,</span> <span class="s2">&quot;Load&quot;</span><span class="p">,</span> <span class="n">margin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span> <span class="n">addSpace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">lbl</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">widgetLabel</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Input file: &#39;</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_combo</span><span class="o">.</span><span class="n">setMinimumWidth</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_combo</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">,</span> <span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_combo</span><span class="o">.</span><span class="n">activated</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_file</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_combo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_button</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;...&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">browse_file</span><span class="p">,</span> <span class="n">autoDefault</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_button</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">()</span><span class="o">.</span><span class="n">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="o">.</span><span class="n">SP_DirOpenIcon</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_button</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">Policy</span><span class="o">.</span><span class="n">Maximum</span><span class="p">,</span> <span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_button</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reload_button</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Reload&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">,</span> <span class="n">autoDefault</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reload_button</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">()</span><span class="o">.</span><span class="n">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="o">.</span><span class="n">SP_BrowserReload</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reload_button</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">,</span> <span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reload_button</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">file_seq</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Sequence&quot;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">browse_file_seq</span><span class="p">,</span> <span class="n">autoDefault</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_seq</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">style</span><span class="p">()</span><span class="o">.</span><span class="n">standardIcon</span><span class="p">(</span><span class="n">QStyle</span><span class="o">.</span><span class="n">SP_DirOpenIcon</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_seq</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">,</span> <span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_seq</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">btnAbort</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Abort&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">autoDefault</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnAbort</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">,</span> <span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">btnAbort</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnAbort</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

        <span class="n">box</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">vBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controlArea</span><span class="p">,</span> <span class="s2">&quot;Info&quot;</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infolabel</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">widgetLabel</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="s1">&#39;No data loaded.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warnings</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">widgetLabel</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># Dictionary view</span>
        <span class="n">box</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">vBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">controlArea</span><span class="p">,</span> <span class="s2">&quot;File viewer&quot;</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span> <span class="o">=</span> <span class="n">QTabWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1">#Tab input</span>
        <span class="n">tabBox</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">vBox</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
        <span class="n">box1</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">hBox</span><span class="p">(</span><span class="n">tabBox</span><span class="p">)</span>
        <span class="n">gui</span><span class="o">.</span><span class="n">widgetLabel</span><span class="p">(</span><span class="n">box1</span><span class="p">,</span><span class="s1">&#39;Send to output: &#39;</span><span class="p">)</span>
        <span class="n">outall_button</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">box1</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Import all&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sendOutputAll</span><span class="p">,</span> <span class="n">autoDefault</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">outall_button</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">Policy</span><span class="o">.</span><span class="n">Maximum</span><span class="p">,</span> <span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="n">outsel_button</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">box1</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Import selected&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sendOutput</span><span class="p">,</span> <span class="n">autoDefault</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">outsel_button</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">Policy</span><span class="o">.</span><span class="n">Maximum</span><span class="p">,</span> <span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="n">gui</span><span class="o">.</span><span class="n">checkBox</span><span class="p">(</span><span class="n">tabBox</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;enable_multiselect&#39;</span><span class="p">,</span> <span class="s1">&#39;Enable multi selection&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">check_multiselect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerIn</span> <span class="o">=</span> <span class="n">DictionaryTreeWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerIn</span><span class="o">.</span><span class="n">itemClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">displayDataIn</span><span class="p">)</span>
        <span class="n">tabBox</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerIn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">tabBox</span><span class="p">,</span> <span class="s1">&#39;Input&#39;</span><span class="p">)</span>

        <span class="c1">#Tab output</span>
        <span class="n">tabBox</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">vBox</span><span class="p">(</span><span class="n">box</span><span class="p">)</span>
        <span class="n">box1</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">hBox</span><span class="p">(</span><span class="n">tabBox</span><span class="p">)</span>
        <span class="n">gui</span><span class="o">.</span><span class="n">widgetLabel</span><span class="p">(</span><span class="n">box1</span><span class="p">,</span><span class="s1">&#39;Output: &#39;</span><span class="p">)</span>
        <span class="c1">#TODO: Need for additional data??</span>
        <span class="c1"># addnl = gui.button(box1, self, &#39;Additional data&#39;, callback=self.additionalData)</span>
        <span class="c1"># addnl.setSizePolicy(Policy.Maximum, Policy.Fixed)</span>
        <span class="n">clear_output</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">box1</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Clear output&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">clearOutput</span><span class="p">)</span>
        <span class="n">clear_output</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">Policy</span><span class="o">.</span><span class="n">Maximum</span><span class="p">,</span> <span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="n">box2</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">hBox</span><span class="p">(</span><span class="n">tabBox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infoLoad</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">widgetLabel</span><span class="p">(</span><span class="n">box2</span><span class="p">,</span> <span class="s2">&quot;Select &lt;a href=&#39;xyz&#39;&gt;custom datasets&lt;/a&gt; for data analysis (only of type MetrologyData).&quot;</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infoLoad</span><span class="o">.</span><span class="n">setTextInteractionFlags</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">LinksAccessibleByMouse</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infoLoad</span><span class="o">.</span><span class="n">linkActivated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">select_custom_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">done_custom_select</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">box2</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Done&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">doneSelection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">done_custom_select</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">Policy</span><span class="o">.</span><span class="n">Maximum</span><span class="p">,</span> <span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">done_custom_select</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="n">box3</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">hBox</span><span class="p">(</span><span class="n">tabBox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infoCustomData</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">widgetLabel</span><span class="p">(</span><span class="n">box3</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infoCustomData</span><span class="o">.</span><span class="n">setWordWrap</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span> <span class="o">=</span> <span class="n">DictionaryTreeWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span><span class="o">.</span><span class="n">itemClicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">displayDataOut</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span><span class="o">.</span><span class="n">setContextMenuPolicy</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CustomContextMenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span><span class="o">.</span><span class="n">customContextMenuRequested</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rightClickTreeItem</span><span class="p">)</span>
        <span class="n">tabBox</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">addTab</span><span class="p">(</span><span class="n">tabBox</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">)</span>
        <span class="n">box</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="p">)</span>

        <span class="c1"># Data viewer</span>
        <span class="n">box</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">vBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mainArea</span><span class="p">,</span> <span class="s2">&quot;Data viewer&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dataViewer</span> <span class="o">=</span> <span class="n">DataViewerFrameOrange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">editInfo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_mask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">box</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dataViewer</span><span class="p">)</span>

        <span class="c1"># Convert to metroogy data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menuMetData</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMenu</span><span class="p">()</span>
        <span class="n">actionMetData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">menuMetData</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s2">&quot;Convert to Metrology Data&quot;</span><span class="p">)</span>
        <span class="n">actionMetData</span><span class="o">.</span><span class="n">triggered</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convToMetrologyData</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Outputs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_task</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span> <span class="o">=</span> <span class="n">ThreadExecutor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dataViewer</span><span class="o">.</span><span class="n">infoChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Outputs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">))</span>

<div class="viewcode-block" id="OWFileExternal.abort"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.abort">[docs]</a>    <span class="k">def</span> <span class="nf">abort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Callback for abort button. File loading is done in another thread and when aborted the thread is cancelled&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearViewer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearInputData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_seq</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reload_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btnAbort</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">set_output_summary</span><span class="p">(</span><span class="s1">&#39;Aborted loading&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finProgressBar</span><span class="p">()</span></div>

<div class="viewcode-block" id="OWFileExternal.cancel"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.cancel">[docs]</a>    <span class="k">def</span> <span class="nf">cancel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cancel the current task, i.e. loading a file or sequence of files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_task</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task</span><span class="o">.</span><span class="n">future</span><span class="o">.</span><span class="n">done</span><span class="p">()</span>
            <span class="c1"># disconnect the `_task_finished` slot</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_task</span><span class="o">.</span><span class="n">watcher</span><span class="o">.</span><span class="n">done</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_finished</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_task</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="OWFileExternal.onDeleteWidget"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.onDeleteWidget">[docs]</a>    <span class="k">def</span> <span class="nf">onDeleteWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Cancel running tasks like loading files before destroying widget&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">onDeleteWidget</span><span class="p">()</span></div>

<div class="viewcode-block" id="OWFileExternal.displayDataIn"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.displayDataIn">[docs]</a>    <span class="k">def</span> <span class="nf">displayDataIn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display the selected item in input tree viewer&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_multiselect</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerIn</span><span class="o">.</span><span class="n">get_selected_data</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dataViewer</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dataViewer</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="OWFileExternal.displayDataOut"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.displayDataOut">[docs]</a>    <span class="k">def</span> <span class="nf">displayDataOut</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Display the selected item in output tree viewer&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span><span class="o">.</span><span class="n">get_selected_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dataViewer</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="OWFileExternal.enableOptions"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.enableOptions">[docs]</a>    <span class="k">def</span> <span class="nf">enableOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enable checkboxes&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">enable_multiselect</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="OWFileExternal.disableOptions"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.disableOptions">[docs]</a>    <span class="k">def</span> <span class="nf">disableOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Disable checkboxes&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">controls</span><span class="o">.</span><span class="n">enable_multiselect</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearViewer</span><span class="p">()</span></div>

<div class="viewcode-block" id="OWFileExternal.clearViewer"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.clearViewer">[docs]</a>    <span class="k">def</span> <span class="nf">clearViewer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear data viewer and input file treeviewer&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerIn</span><span class="o">.</span><span class="n">clearData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dataViewer</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="OWFileExternal.close"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#TODO: close any opened files</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="OWFileExternal.sizeHint"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.sizeHint">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">sizeHint</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">QSize</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span></div>

<div class="viewcode-block" id="OWFileExternal.set_data"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.set_data">[docs]</a>    <span class="nd">@Inputs</span><span class="o">.</span><span class="n">data</span>
    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Linked to data input channel. Loads data from last widget as input data within this widget. The output data is not replaced.</span>

<span class="sd">        :param data: Input data</span>
<span class="sd">        :type data: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Table</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;input_data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)}</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Error</span><span class="o">.</span><span class="n">incorrect_input</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enableOptions</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disableOptions</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_messages</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerIn</span><span class="o">.</span><span class="n">updateDictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_in</span><span class="p">)</span></div>

<div class="viewcode-block" id="OWFileExternal.select_file"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.select_file">[docs]</a>    <span class="k">def</span> <span class="nf">select_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select file from dropdown</span>

<span class="sd">        :param n: selected file number</span>
<span class="sd">        :type n: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recent_paths</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">select_file</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recent_paths</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_file_list</span><span class="p">()</span></div>

<div class="viewcode-block" id="OWFileExternal.doneSelection"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.doneSelection">[docs]</a>    <span class="k">def</span> <span class="nf">doneSelection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called after selected custom datasets.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">done_custom_select</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()</span>
        <span class="n">selected_txt</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">selected</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">)],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_DATA_NAMES</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infoCustomData</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Custom datasets: &#39;</span><span class="o">+</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">selected_txt</span><span class="p">))</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span><span class="p">[</span><span class="s1">&#39;CUSTOM_DATA_NAMES&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;CUSTOM_DATA_NAMES&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span> <span class="k">else</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="s1">&#39;CUSTOM_DATA_NAMES&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="n">selected_txt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">SingleSelection</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span><span class="o">.</span><span class="n">clearSelection</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">selected_txt</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Outputs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">)</span></div>

<div class="viewcode-block" id="OWFileExternal.select_custom_data"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.select_custom_data">[docs]</a>    <span class="k">def</span> <span class="nf">select_custom_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Enable selection of custom data&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">done_custom_select</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">MultiSelection</span><span class="p">)</span></div>

<div class="viewcode-block" id="OWFileExternal.rightClickTreeItem"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.rightClickTreeItem">[docs]</a>    <span class="k">def</span> <span class="nf">rightClickTreeItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Right click menu for file treeviewer</span>

<span class="sd">        :param point: xy position</span>
<span class="sd">        :type point: QPoint</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span><span class="o">.</span><span class="n">get_selected_data</span><span class="p">(</span><span class="n">baseNode</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selData</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">menuMetData</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span><span class="n">point</span><span class="p">))</span></div>

<div class="viewcode-block" id="OWFileExternal.convToMetrologyData"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.convToMetrologyData">[docs]</a>    <span class="k">def</span> <span class="nf">convToMetrologyData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert loaded data into orange-pylost data format MetrologyData&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selData</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">selData</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Quantity</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;pix_size&#39;</span><span class="p">,</span> <span class="s1">&#39;axis_names&#39;</span><span class="p">,</span> <span class="s1">&#39;detector_dimensions&#39;</span><span class="p">,</span> <span class="s1">&#39;full_size&#39;</span><span class="p">,</span> <span class="s1">&#39;start_pos&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;full_size&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_DATA_NAMES</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_DATA_NAMES</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="o">.</span><span class="n">keys</span><span class="p">()))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;full_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>

        <span class="n">dialog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ConvertToMetrologyData</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">get_all_params</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_metrology_data</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">selItem</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span><span class="o">.</span><span class="n">currentItem</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_comment</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span><span class="o">.</span><span class="n">updateDictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Outputs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">set_output_summary</span><span class="p">(</span><span class="s1">&#39;Updated output data&#39;</span><span class="p">)</span></div>
            <span class="c1"># return self.Information.info(&#39;Updated output data&#39;)</span>

    <span class="c1"># def additionalData(self):</span>
    <span class="c1">#     self.source = 3</span>
    <span class="c1">#     kwargs = {}</span>
    <span class="c1">#     for item in [&#39;pix_size&#39;, &#39;axis_names&#39;, &#39;detector_dimensions&#39;, &#39;full_size&#39;, &#39;start_pos&#39;]:</span>
    <span class="c1">#         if item in self.data_out:</span>
    <span class="c1">#             kwargs[item] = self.data_out[item]</span>
    <span class="c1">#     if &#39;full_size&#39; not in kwargs and any(set(self.DEFAULT_DATA_NAMES).intersection(self.data_out.keys())):</span>
    <span class="c1">#         key = list(set(self.DEFAULT_DATA_NAMES).intersection(self.data_out.keys()))[0]</span>
    <span class="c1">#         kwargs[&#39;full_size&#39;] = self.data_out[key].shape</span>
    <span class="c1">#</span>
    <span class="c1">#     dialog = self.ImportAdditionalDialog(parent=self, **kwargs)</span>
    <span class="c1">#     if dialog.exec_():</span>
    <span class="c1">#         vals = dialog.get_all_params()</span>
    <span class="c1">#         for item in vals:</span>
    <span class="c1">#             self.data_out[item] = vals[item]</span>
    <span class="c1">#</span>
    <span class="c1">#         self.update_metrology_data(vals)</span>
    <span class="c1">#         self.update_comment()</span>
    <span class="c1">#         self.__treeViewerOut.updateDictionary(self.data_out)</span>
    <span class="c1">#         self.Outputs.data.send(self.data_out)</span>
    <span class="c1">#         self.info.set_output_summary(&#39;Updated output data&#39;)</span>
    <span class="c1">#         # return self.Information.info(&#39;Updated output data&#39;)</span>

<div class="viewcode-block" id="OWFileExternal.clearOutput"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.clearOutput">[docs]</a>    <span class="k">def</span> <span class="nf">clearOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear output&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearOutputData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Outputs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="OWFileExternal.clearOutputData"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.clearOutputData">[docs]</a>    <span class="k">def</span> <span class="nf">clearOutputData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear output file viewer and data viewer&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infoCustomData</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span><span class="o">.</span><span class="n">clearData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dataViewer</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="OWFileExternal.clearInputData"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.clearInputData">[docs]</a>    <span class="k">def</span> <span class="nf">clearInputData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear input file viewer and data viewer&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerIn</span><span class="o">.</span><span class="n">clearData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dataViewer</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="OWFileExternal.update_comment"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.update_comment">[docs]</a>    <span class="k">def</span> <span class="nf">update_comment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update comment log&quot;&quot;&quot;</span>
        <span class="n">cmt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="s1">&#39;comment_log&#39;</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="s1">&#39;comment_log&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">cmt</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">cmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span><span class="p">[</span><span class="s1">&#39;comment_log&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="s1">&#39;comment_log&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="s1">&#39;comment_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmt</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="s1">&#39;comment_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmt</span> <span class="o">+</span> <span class="s1">&#39;Data loaded from file </span><span class="si">{}</span><span class="s1">.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_path</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_path</span><span class="p">())</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_seq</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="s1">&#39;comment_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmt</span> <span class="o">+</span> <span class="s1">&#39;Data loaded from file sequence [</span><span class="si">{}</span><span class="s1">...]&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_seq</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_seq</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">source</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="s1">&#39;comment_log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cmt</span> <span class="o">+</span> <span class="s1">&#39;Additional data loaded from manual input.&#39;</span>
        <span class="c1"># elif self.source==4:</span>
        <span class="c1">#     self.data_out[&#39;comment_log&#39;] = cmt + &#39;Data converted to metrology datasets.&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;h5path&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">::</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="s1">&#39;h5path&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="OWFileExternal.sendOutputAll"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.sendOutputAll">[docs]</a>    <span class="k">def</span> <span class="nf">sendOutputAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send all the items in input to output&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_messages</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">questionMsgAdv</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Merge data?&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Output has existing data. Press &quot;yes&quot; to merge items, &#39;</span>
                                                          <span class="s1">&#39;and &quot;no&quot; to fully replace output data&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">elif</span> <span class="n">val</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="n">copy_items</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_in</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">deepcopy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">update_comment</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span><span class="o">.</span><span class="n">updateDictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Outputs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">set_output_summary</span><span class="p">(</span><span class="s1">&#39;Updated output data&#39;</span><span class="p">)</span></div>
        <span class="c1"># return self.Information.info(&#39;Updated output data&#39;)</span>

<div class="viewcode-block" id="OWFileExternal.sendOutput"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.sendOutput">[docs]</a>    <span class="k">def</span> <span class="nf">sendOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send selected items in input to output&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_messages</span><span class="p">()</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerIn</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">selected</span><span class="p">):</span>
            <span class="n">selected_txt</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">]</span>
            <span class="n">dialog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImportDialog</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">sel_items</span><span class="o">=</span><span class="n">selected_txt</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">):</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">questionMsgAdv</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Merge data?&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Press &quot;yes&quot; to only update / merge selected items, &#39;</span>
                                                                  <span class="s1">&#39;and &quot;no&quot; to fully replace output data&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">return</span>
                <span class="n">sel_keys</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerIn</span><span class="o">.</span><span class="n">get_selected_data</span><span class="p">(</span><span class="n">baseNode</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">unit</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dialog</span><span class="o">.</span><span class="n">map_items</span><span class="p">:</span>
                        <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">unitWidget</span><span class="p">)</span> <span class="o">=</span> <span class="n">dialog</span><span class="o">.</span><span class="n">map_items</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                        <span class="n">unit</span> <span class="o">=</span> <span class="n">unitWidget</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">unit</span><span class="o">!=</span><span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MetrologyData</span><span class="p">:</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">update_output</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                    <span class="n">sel_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">update_metrology_data</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">new_keys</span><span class="o">=</span><span class="n">sel_keys</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_comment</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span><span class="o">.</span><span class="n">updateDictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Outputs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">set_output_summary</span><span class="p">(</span><span class="s1">&#39;Updated output data&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="OWFileExternal.update_metrology_data"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.update_metrology_data">[docs]</a>    <span class="k">def</span> <span class="nf">update_metrology_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">new_keys</span><span class="o">=</span><span class="p">[],</span> <span class="n">selItem</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert input numpy arrays of height/slopes_x/slopes_y to MetrologyData and update output data.</span>

<span class="sd">        :param vals: Output data dictionary</span>
<span class="sd">        :type vals: dict</span>
<span class="sd">        :param new_keys: New names for the selected input items</span>
<span class="sd">        :type new_keys: list</span>
<span class="sd">        :param selItem: Selected output item, if any</span>
<span class="sd">        :type selItem: QTreeWidgetItem</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">selItem</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">selData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span><span class="o">.</span><span class="n">get_selected_data</span><span class="p">(</span><span class="n">selItem</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span><span class="o">.</span><span class="n">get_selected_path</span><span class="p">(</span><span class="n">selItem</span><span class="p">,</span> <span class="p">[])</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">hasChanged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toMetrologyData</span><span class="p">(</span><span class="n">selData</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">new_keys</span><span class="o">=</span><span class="n">new_keys</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">selItem</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">hasChanged</span><span class="p">:</span>
                <span class="n">fill_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_DATA_NAMES</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">walk_dict</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="p">[])</span>
                <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">get_dict_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
                    <span class="n">data</span><span class="p">,</span> <span class="n">hasChanged</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toMetrologyData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">new_keys</span><span class="o">=</span><span class="n">new_keys</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">hasChanged</span><span class="p">:</span>
                        <span class="n">fill_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">walk_dict_by_type</span><span class="p">(</span><span class="n">MetrologyData</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="p">[])</span>
            <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">get_dict_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;pix_size&#39;</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">_set_pix_size</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="s1">&#39;pix_size&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s1">&#39;detector_dimensions&#39;</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">_set_dim_detector</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="s1">&#39;detector_dimensions&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s1">&#39;axis_names&#39;</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">_set_axis_names</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="s1">&#39;axis_names&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s1">&#39;full_size&#39;</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">_set_init_shape</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="s1">&#39;full_size&#39;</span><span class="p">])</span></div>

<div class="viewcode-block" id="OWFileExternal.toMetrologyData"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.toMetrologyData">[docs]</a>    <span class="k">def</span> <span class="nf">toMetrologyData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">new_keys</span><span class="o">=</span><span class="p">[],</span> <span class="n">item</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert from numpy array / Quantity to MetrologyData or update the MetrologyData parameters.</span>

<span class="sd">        :param data: Height or slope item data</span>
<span class="sd">        :type data: numpy.ndarray / Quantity / MetrologyData</span>
<span class="sd">        :param vals: Output data dictionary</span>
<span class="sd">        :type vals: dict</span>
<span class="sd">        :param new_keys: New names for the selected input items</span>
<span class="sd">        :type new_keys: list</span>
<span class="sd">        :param item: Selected output item, if any</span>
<span class="sd">        :type item: QTreeWidgetItem</span>
<span class="sd">        :return: Converted dataset, is conversion successful?</span>
<span class="sd">        :rtype: MetrologyData, bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hasChanged</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">vals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;xyz_to_z&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">data</span><span class="p">,</span> <span class="n">px</span><span class="p">,</span> <span class="n">py</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xyz_to_z</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">pix_unit</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pix_unit&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;pix_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">Quantity</span><span class="p">(</span><span class="n">py</span><span class="p">,</span> <span class="n">pix_unit</span><span class="p">),</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">pix_unit</span><span class="p">)]</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="ow">and</span> <span class="s1">&#39;unit&#39;</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">])</span>
            <span class="n">hasChanged</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Quantity</span> <span class="ow">and</span> <span class="s1">&#39;pix_size&#39;</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
            <span class="n">pix_sz</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;pix_size&#39;</span><span class="p">]</span>
            <span class="n">dim_det</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;det_dim&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;det_dim&#39;</span> <span class="ow">in</span> <span class="n">vals</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_dim_detector</span>
            <span class="n">axis_names</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;axis_names&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;axis_names&#39;</span> <span class="ow">in</span> <span class="n">vals</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_axis_names</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">MetrologyData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">pix_size</span><span class="o">=</span><span class="n">pix_sz</span><span class="p">,</span> <span class="n">dim_detector</span><span class="o">=</span><span class="n">dim_det</span><span class="p">,</span> <span class="n">axis_names</span><span class="o">=</span><span class="n">axis_names</span><span class="p">)</span>
            <span class="n">hasChanged</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="n">MetrologyData</span><span class="p">:</span>
            <span class="n">motors</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">motors</span>
            <span class="n">hasChangedMotors</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;motor_X&#39;</span><span class="p">,</span><span class="s1">&#39;motor_Y&#39;</span><span class="p">,</span><span class="s1">&#39;motor_Z&#39;</span><span class="p">,</span><span class="s1">&#39;motor_RX&#39;</span><span class="p">,</span><span class="s1">&#39;motor_RY&#39;</span><span class="p">,</span><span class="s1">&#39;motor_RZ&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">vals</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">new_keys</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">Quantity</span><span class="p">):</span>
                    <span class="n">mkey</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="n">vals</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="s1">&#39;axis&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">)}</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mkey</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Error</span><span class="o">.</span><span class="n">unknown</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; size (</span><span class="si">{}</span><span class="s1">) does not find match in &quot;</span><span class="si">{}</span><span class="s1">&quot; shape (</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mkey</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]),</span> <span class="n">item</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">mkey</span><span class="p">[</span><span class="s1">&#39;axis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mkey</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]))</span>
                        <span class="n">has_key</span><span class="p">,</span> <span class="n">md</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">motors_hs_key</span><span class="p">(</span><span class="n">motors</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">has_key</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">md</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">],</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">md</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">])</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">questionMsg</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> values exist&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
                                               <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;&quot;</span><span class="si">{}</span><span class="s1">&quot; values already exist in &quot;</span><span class="si">{}</span><span class="s1">&quot; data. Press &quot;yes&quot; to replace with new values&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">item</span><span class="p">)):</span>
                                    <span class="n">motors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_motor_values</span><span class="p">(</span><span class="n">motors</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">mkey</span><span class="p">)</span>
                                    <span class="n">hasChangedMotors</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="c1"># Replace motor values with new values</span>
                                <span class="n">motors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">replace_motor_values</span><span class="p">(</span><span class="n">motors</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">mkey</span><span class="p">)</span>
                                <span class="n">hasChangedMotors</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">motors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_motor_values</span><span class="p">(</span><span class="n">motors</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">mkey</span><span class="p">)</span>
                            <span class="n">hasChangedMotors</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">hasChangedMotors</span><span class="p">:</span>
                <span class="n">hasChanged</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">data</span><span class="o">.</span><span class="n">_set_motors</span><span class="p">(</span><span class="n">motors</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">hasChanged</span></div>

<div class="viewcode-block" id="OWFileExternal.xyz_to_z"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.xyz_to_z">[docs]</a>    <span class="k">def</span> <span class="nf">xyz_to_z</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert data from xyz format to image format</span>
<span class="sd">        :param data: xyz data</span>
<span class="sd">        :type data: numpy.ndarray</span>
<span class="sd">        :return: image format, step x, step y</span>
<span class="sd">        :rtype: numpy.ndarray, float, float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">dx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="n">dy</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span></div>

<div class="viewcode-block" id="OWFileExternal.add_motor_values"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.add_motor_values">[docs]</a>    <span class="k">def</span> <span class="nf">add_motor_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motors</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">mkey</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new motor dataset</span>

<span class="sd">        :param motors: Motors list</span>
<span class="sd">        :type motors: list</span>
<span class="sd">        :param key: Name of the motor, e.g. motor_X</span>
<span class="sd">        :type key: str</span>
<span class="sd">        :param mkey: motor values, format {&#39;values&#39;:[...], &#39;unit&#39;:&#39;&#39;, &#39;name&#39;:&#39;&#39;}</span>
<span class="sd">        :type mkey: dict</span>
<span class="sd">        :return: Updates motors</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">motors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">motors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mkey</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">motors</span> <span class="o">=</span> <span class="p">[</span><span class="n">mkey</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">motors</span></div>

<div class="viewcode-block" id="OWFileExternal.replace_motor_values"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.replace_motor_values">[docs]</a>    <span class="k">def</span> <span class="nf">replace_motor_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motors</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">mkey</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace motor values for given name</span>

<span class="sd">        :param motors: Motors list</span>
<span class="sd">        :type motors: list</span>
<span class="sd">        :param key: Name of the motor, e.g. motor_X</span>
<span class="sd">        :type key: str</span>
<span class="sd">        :param mkey: motor values, format {&#39;values&#39;:[...], &#39;unit&#39;:&#39;&#39;, &#39;name&#39;:&#39;&#39;}</span>
<span class="sd">        :type mkey: dict</span>
<span class="sd">        :return: Updates motors</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">motors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">motors</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">motors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">motors</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">mkey</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">motors</span></div>

<div class="viewcode-block" id="OWFileExternal.motors_hs_key"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.motors_hs_key">[docs]</a>    <span class="k">def</span> <span class="nf">motors_hs_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motors</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if motor-list has the selected motor.</span>

<span class="sd">        :param motors: Motors list</span>
<span class="sd">        :type motors: list</span>
<span class="sd">        :param key: Name of the motor, e.g. motor_X</span>
<span class="sd">        :type key: str</span>
<span class="sd">        :return: Has motor?, values for selected motor</span>
<span class="sd">        :rtype: bool, dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">motors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">motors</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">m</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="OWFileExternal.update_output"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.update_output">[docs]</a>    <span class="k">def</span> <span class="nf">update_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update output data dictionary with new key and values</span>

<span class="sd">        :param key: New key</span>
<span class="sd">        :type key: str</span>
<span class="sd">        :param data: New value for the key</span>
<span class="sd">        :type data:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">walk_dict</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">out</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fill_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">questionMsgAdv</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Update multiple items&#39;</span><span class="p">,</span>
                           <span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Many items found with selected key &quot;</span><span class="si">{}</span><span class="s1">&quot;. &#39;</span>
                               <span class="s1">&#39;Press &quot;yes&quot; to update all items, and &quot;no&quot; to update only first found item&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">out</span><span class="p">:</span>
                    <span class="n">fill_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">val</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">fill_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="OWFileExternal.browse_file_seq"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.browse_file_seq">[docs]</a>    <span class="k">def</span> <span class="nf">browse_file_seq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load a sequence of files, e.g. subapertures&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">start_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_path</span><span class="p">()</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/&quot;</span><span class="p">)</span>

            <span class="n">readers</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">formats</span>
                       <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                       <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;EXTENSIONS&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
            <span class="n">filename_list</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">open_multifile_dialog</span><span class="p">(</span><span class="n">start_file</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">readers</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">filename_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">filename_list</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>
                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task</span> <span class="ow">is</span> <span class="kc">None</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">setStatusMessage</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clear_messages</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clearViewer</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filename_seq</span> <span class="o">=</span> <span class="n">filename_list</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_path</span><span class="p">(</span><span class="n">filename_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">get_reader</span><span class="p">(</span><span class="n">filename_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">reader</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">reader</span><span class="p">(</span><span class="n">filename_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

                <span class="n">seq_cls</span> <span class="o">=</span> <span class="n">FileSeqLoader</span><span class="p">()</span>
                <span class="n">seq_cls</span><span class="o">.</span><span class="n">progress</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">report_progress</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_task</span> <span class="o">=</span> <span class="n">task</span> <span class="o">=</span> <span class="n">Task</span><span class="p">()</span>
                <span class="n">end_progressbar</span> <span class="o">=</span> <span class="n">methodinvoke</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;finProgressBar&quot;</span><span class="p">,</span> <span class="p">())</span>
                <span class="k">def</span> <span class="nf">callback</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">task</span><span class="o">.</span><span class="n">cancelled</span><span class="p">:</span>
                        <span class="n">end_progressbar</span><span class="p">()</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Aborted loading&#39;</span><span class="p">)</span>
                <span class="n">load_fun</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">seq_cls</span><span class="o">.</span><span class="n">load_file_seq</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="n">callback</span><span class="p">,</span> <span class="n">filename_list</span><span class="o">=</span><span class="n">filename_list</span><span class="p">,</span> <span class="n">reader</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">startProgressBar</span><span class="p">()</span>
                <span class="n">task</span><span class="o">.</span><span class="n">future</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">load_fun</span><span class="p">)</span>
                <span class="n">task</span><span class="o">.</span><span class="n">watcher</span> <span class="o">=</span> <span class="n">FutureWatcher</span><span class="p">(</span><span class="n">task</span><span class="o">.</span><span class="n">future</span><span class="p">)</span>
                <span class="n">task</span><span class="o">.</span><span class="n">watcher</span><span class="o">.</span><span class="n">done</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_finished</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_seq</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reload_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">file_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">btnAbort</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">progressBarFinished</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="o">=</span><span class="n">ex</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Error</span><span class="o">.</span><span class="n">unknown</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">))</span></div>

    <span class="nd">@pyqtSlot</span><span class="p">(</span><span class="n">concurrent</span><span class="o">.</span><span class="n">futures</span><span class="o">.</span><span class="n">Future</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_task_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback after the flie sequence is completed.</span>

<span class="sd">        :param f: Result containing loaded file sequence data</span>
<span class="sd">        :type f: concurrent.futures.Future</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">()</span> <span class="ow">is</span> <span class="n">QThread</span><span class="o">.</span><span class="n">currentThread</span><span class="p">()</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task</span><span class="o">.</span><span class="n">future</span> <span class="ow">is</span> <span class="n">f</span>
        <span class="k">assert</span> <span class="n">f</span><span class="o">.</span><span class="n">done</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_task</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endProgressBar</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_seq</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">file_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reload_button</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btnAbort</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_in</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">autoFillOutput</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerIn</span><span class="o">.</span><span class="n">updateDictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_in</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setStatusMessage</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename_seq</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
                <span class="k">if</span> <span class="n">config_params</span><span class="o">.</span><span class="n">DEFAULT_CLOSE_WIDGETS_AFTER_APPLY</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Error</span><span class="o">.</span><span class="n">unknown</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

<div class="viewcode-block" id="OWFileExternal.report_progress"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.report_progress">[docs]</a>    <span class="k">def</span> <span class="nf">report_progress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update progressbar</span>

<span class="sd">        :param val: New progress value</span>
<span class="sd">        :type val: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setProgressValue</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Error</span><span class="o">.</span><span class="n">unknown</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>

<div class="viewcode-block" id="OWFileExternal.setProgressValue"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.setProgressValue">[docs]</a>    <span class="nd">@pyqtSlot</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">setProgressValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set progressbar value</span>

<span class="sd">        :param value: New progress value</span>
<span class="sd">        :type value: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">()</span> <span class="ow">is</span> <span class="n">QThread</span><span class="o">.</span><span class="n">currentThread</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">progressBarSet</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="OWFileExternal.finProgressBar"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.finProgressBar">[docs]</a>    <span class="nd">@pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">finProgressBar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finish progress bar</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">()</span> <span class="ow">is</span> <span class="n">QThread</span><span class="o">.</span><span class="n">currentThread</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">endProgressBar</span><span class="p">()</span></div>

<div class="viewcode-block" id="OWFileExternal.startProgressBar"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.startProgressBar">[docs]</a>    <span class="k">def</span> <span class="nf">startProgressBar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Start progress bar&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progressBarInit</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Error</span><span class="o">.</span><span class="n">unknown</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>

<div class="viewcode-block" id="OWFileExternal.endProgressBar"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.endProgressBar">[docs]</a>    <span class="k">def</span> <span class="nf">endProgressBar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;End progress bar&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">progressBarFinished</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Error</span><span class="o">.</span><span class="n">unknown</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>

<div class="viewcode-block" id="OWFileExternal.browse_file"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.browse_file">[docs]</a>    <span class="k">def</span> <span class="nf">browse_file</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Browse a single file with known extension, and load data&quot;&quot;&quot;</span>
        <span class="n">start_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_path</span><span class="p">()</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/&quot;</span><span class="p">)</span>

        <span class="n">readers</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">formats</span>
                   <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                   <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;EXTENSIONS&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">reader</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">open_filename_dialog</span><span class="p">(</span><span class="n">start_file</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">readers</span><span class="p">)</span>
        <span class="c1"># filename, filter = QFileDialog.getOpenFileName(self, &quot;Select File&quot;, start_file,&#39;*.h5&#39;)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">reader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recent_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">file_format</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">qualified_name</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">()</span></div>

    <span class="c1"># Open a file, create data from it and send it over the data channel</span>
<div class="viewcode-block" id="OWFileExternal.load_data"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.load_data">[docs]</a>    <span class="k">def</span> <span class="nf">load_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Load data from a file&quot;&quot;&quot;</span>
        <span class="c1"># We need to catch any exception type since anything can happen in</span>
        <span class="c1"># file readers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setStatusMessage</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_messages</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_file_list</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_path</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_path</span><span class="p">()):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Error</span><span class="o">.</span><span class="n">file_not_found</span>

        <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_try_load</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">error</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Outputs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">infolabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;No data.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">set_output_summary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">NoOutput</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_try_load</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call file reader &#39;read&#39; function to load data&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_reader</span><span class="p">()</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Error</span><span class="o">.</span><span class="n">missing_reader</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">NoFileSelected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Outputs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">set_output_summary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">NoOutput</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">with</span> <span class="n">catch_warnings</span><span class="p">(</span><span class="n">record</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">as</span> <span class="n">warnings</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clearViewer</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span> <span class="o">=</span> <span class="n">data</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;file_data&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Table</span> <span class="k">else</span> <span class="n">data</span><span class="p">}</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerIn</span><span class="o">.</span><span class="n">updateDictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_in</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">autoFillOutput</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reader</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;h5path&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setStatusMessage</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">::</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_path</span><span class="p">()),</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span><span class="p">[</span><span class="s1">&#39;h5path&#39;</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setStatusMessage</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_path</span><span class="p">())))</span>
                <span class="k">if</span> <span class="n">config_params</span><span class="o">.</span><span class="n">DEFAULT_CLOSE_WIDGETS_AFTER_APPLY</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setStatusMessage</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="o">=</span><span class="n">ex</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Error</span><span class="o">.</span><span class="n">unknown</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">warnings</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Warning</span><span class="o">.</span><span class="n">load_warning</span><span class="p">(</span><span class="n">warnings</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">infolabel</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;Data loaded.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_get_reader</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FileFormat</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get file reader&quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_path</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">NoFileSelected</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recent_paths</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">recent_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">file_format</span><span class="p">:</span>
            <span class="n">qname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recent_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">file_format</span>
            <span class="n">reader_class</span> <span class="o">=</span> <span class="n">class_from_qualified_name</span><span class="p">(</span><span class="n">qname</span><span class="p">)</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">reader_class</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="n">FileFormat</span><span class="o">.</span><span class="n">get_reader</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recent_paths</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">recent_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sheet</span><span class="p">:</span>
            <span class="n">reader</span><span class="o">.</span><span class="n">select_sheet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">recent_paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sheet</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">reader</span>

<div class="viewcode-block" id="OWFileExternal.check_multiselect"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.check_multiselect">[docs]</a>    <span class="k">def</span> <span class="nf">check_multiselect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check multiple selection in the treeview&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_multiselect</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerIn</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">MultiSelection</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerIn</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">SingleSelection</span><span class="p">)</span></div>

    <span class="c1">#TODO : Correctly specify which axis is represented by which motor</span>
<div class="viewcode-block" id="OWFileExternal.autoFillOutput"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.autoFillOutput">[docs]</a>    <span class="k">def</span> <span class="nf">autoFillOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reader</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Auto fill output if implemented by the file reader in &#39;data_standard_format&#39; function&quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">motors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="s1">&#39;clear_output_before_loading&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clearOutputData</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">PickleReader</span><span class="p">,</span> <span class="n">H5Reader</span><span class="p">]:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_in</span>
            <span class="n">copy_items</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">,</span> <span class="n">deepcopy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">reader</span><span class="p">,</span> <span class="s1">&#39;data_standard_format&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">data_standard_format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_in</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">update_output</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tabs</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># self.update_metrology_data(vals=self.data_out)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_comment</span><span class="p">()</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;custom&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__treeViewerOut</span><span class="o">.</span><span class="n">updateDictionary</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Outputs</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_out</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="o">.</span><span class="n">set_output_summary</span><span class="p">(</span><span class="s1">&#39;Updated output data&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="OWFileExternal.ConvertToMetrologyData"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.ConvertToMetrologyData">[docs]</a>    <span class="k">class</span> <span class="nc">ConvertToMetrologyData</span><span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">UI_met_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a numpy array or astropy.Quantity into MEtrologyData&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">QDialog</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;unit&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataset_unit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_vis</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="s1">&#39;pix_size&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pix_size&#39;</span><span class="p">],</span> <span class="n">Quantity</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pix_size</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_vis</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pix_size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pix_size_unit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_vis</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pix_size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pix_size</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_vis</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pix_size&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="s1">&#39;axis_names&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axis_names</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_vis</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;axis_names&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="s1">&#39;detector_dimensions&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">det_dim</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_vis</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;detector_dimensions&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="s1">&#39;full_size&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">full_size</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_vis</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;full_size&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="s1">&#39;start_pos&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_pos</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_vis</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_pos&#39;</span><span class="p">]))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">rejected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reject</span><span class="p">)</span>

<div class="viewcode-block" id="OWFileExternal.ConvertToMetrologyData.get_all_params"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.ConvertToMetrologyData.get_all_params">[docs]</a>        <span class="k">def</span> <span class="nf">get_all_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Get all parameters entered in the UI&quot;&quot;&quot;</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;unit&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_unit</span><span class="o">.</span><span class="n">text</span><span class="p">()}</span>
            <span class="n">val_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pix_size_unit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
            <span class="n">out</span><span class="p">[</span><span class="s1">&#39;pix_unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_unit</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pix_size</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="s1">&#39;pix_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">val_unit</span><span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_names</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;axis_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">det_dim</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;detector_dimensions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_size</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;full_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pos</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;start_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">out</span><span class="p">[</span><span class="s1">&#39;xyz_to_z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xyz_to_z</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">out</span></div>

        <span class="k">def</span> <span class="nf">_format_vis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Format visulization of params in the UI</span>

<span class="sd">            :param val: Param value</span>
<span class="sd">            :type val: int/float/str</span>
<span class="sd">            :return: Formatted value as string</span>
<span class="sd">            :rtype: str</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="k">return</span> <span class="s1">&#39; x &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_parse_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Parse entered parameter in string format.</span>

<span class="sd">            :param val: PAram value in UI</span>
<span class="sd">            :type val: str</span>
<span class="sd">            :return: Parse value</span>
<span class="sd">            :rtype: int/float/str/bool</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39; x &#39;</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; x &#39;</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">def</span> <span class="nf">_parse_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Parse string stripping edges</span>

<span class="sd">            :param val: Input string</span>
<span class="sd">            :type val: str</span>
<span class="sd">            :return: Parsed string</span>
<span class="sd">            :rtype: str</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39; x &#39;</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; x &#39;</span><span class="p">)]</span>
                <span class="k">elif</span> <span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">val</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="OWFileExternal.ImportAdditionalDialog"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.ImportAdditionalDialog">[docs]</a>    <span class="k">class</span> <span class="nc">ImportAdditionalDialog</span><span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">UI_import_addnl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Not used&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">QDialog</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;pix_size&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pix_size&#39;</span><span class="p">],</span> <span class="n">Quantity</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pix_size</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_vis</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pix_size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pix_size_unit</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_vis</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pix_size&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">pix_size</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_vis</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pix_size&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="s1">&#39;axis_names&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axis_names</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_vis</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;axis_names&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="s1">&#39;detector_dimensions&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">det_dim</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_vis</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;detector_dimensions&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="s1">&#39;full_size&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">full_size</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_vis</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;full_size&#39;</span><span class="p">]))</span>
            <span class="k">if</span> <span class="s1">&#39;start_pos&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_pos</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_format_vis</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;start_pos&#39;</span><span class="p">]))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">rejected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reject</span><span class="p">)</span>

<div class="viewcode-block" id="OWFileExternal.ImportAdditionalDialog.get_all_params"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.ImportAdditionalDialog.get_all_params">[docs]</a>        <span class="k">def</span> <span class="nf">get_all_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pix_size</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">val_unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pix_size_unit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                <span class="n">out</span><span class="p">[</span><span class="s1">&#39;pix_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">val_unit</span><span class="p">)</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_names</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;axis_names&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">det_dim</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;detector_dimensions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">full_size</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;full_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_pos</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">out</span><span class="p">[</span><span class="s1">&#39;start_pos&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">return</span> <span class="n">out</span></div>

        <span class="k">def</span> <span class="nf">_format_vis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="k">return</span> <span class="s1">&#39; x &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_parse_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39; x &#39;</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; x &#39;</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">def</span> <span class="nf">_parse_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39; x &#39;</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; x &#39;</span><span class="p">)]</span>
                <span class="k">elif</span> <span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">val</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="OWFileExternal.ImportDialog"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.ImportDialog">[docs]</a>    <span class="k">class</span> <span class="nc">ImportDialog</span><span class="p">(</span><span class="n">QDialog</span><span class="p">,</span> <span class="n">UI_import</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Import data dialog&quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sel_items</span><span class="o">=</span><span class="p">[]):</span>
            <span class="n">QDialog</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setupUi</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sel_items</span><span class="p">):</span>
                <span class="n">lbl</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">widgetLabel</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
                <span class="n">lbl</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">,</span> <span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>
                <span class="n">btn</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">left_btn_click</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">autoDefault</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">btn</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
                <span class="n">btn</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">,</span> <span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="n">i</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignCenter</span><span class="p">)</span>

            <span class="n">IMPORT_NAMES</span> <span class="o">=</span> <span class="n">get_import_data_names</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">IMPORT_NAMES</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sel_items</span><span class="p">):</span>
                <span class="n">IMPORT_NAMES</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sel_items</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">IMPORT_NAMES</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">IMPORT_NAMES</span><span class="p">):</span>
                <span class="n">btn</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="k">lambda</span> <span class="n">obj</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">right_btn_click</span><span class="p">(</span><span class="n">j</span><span class="p">),</span> <span class="n">autoDefault</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">btn</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
                <span class="n">btn</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">,</span> <span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">lbl</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">widgetLabel</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
                <span class="n">lbl</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">,</span> <span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">lbl</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignLeft</span><span class="p">)</span>
                <span class="n">le</span> <span class="o">=</span> <span class="n">QLineEdit</span><span class="p">()</span>
                <span class="n">le</span><span class="o">.</span><span class="n">setPlaceholderText</span><span class="p">(</span><span class="s1">&#39;Unit&#39;</span><span class="p">)</span>
                <span class="n">le</span><span class="o">.</span><span class="n">setMaximumWidth</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
                <span class="n">le</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">,</span> <span class="n">Policy</span><span class="o">.</span><span class="n">Fixed</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">le</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignLeft</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;              &#39;</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">alignment</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">AlignRight</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">rejected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reject</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">startPos</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">endPos</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sel_left_pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sel_right_pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">map_items</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMouseTracking</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="OWFileExternal.ImportDialog.setMouseTracking"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.ImportDialog.setMouseTracking">[docs]</a>        <span class="k">def</span> <span class="nf">setMouseTracking</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Link dataset names to standardized name set&quot;&quot;&quot;</span>
            <span class="k">def</span> <span class="nf">recursive_set</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">parent</span><span class="o">.</span><span class="n">findChildren</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">child</span><span class="o">.</span><span class="n">setMouseTracking</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="n">recursive_set</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

            <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QWidget</span><span class="o">.</span><span class="n">setMouseTracking</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">flag</span><span class="p">)</span>
            <span class="n">recursive_set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="OWFileExternal.ImportDialog.left_btn_click"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.ImportDialog.left_btn_click">[docs]</a>        <span class="k">def</span> <span class="nf">left_btn_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Start drawing line&quot;&quot;&quot;</span>
            <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">startPos</span> <span class="o">=</span> <span class="n">button</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span><span class="o">+</span><span class="n">QPoint</span><span class="p">(</span><span class="n">button</span><span class="o">.</span><span class="n">width</span><span class="p">(),</span> <span class="n">button</span><span class="o">.</span><span class="n">height</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sel_left_pos</span> <span class="o">=</span> <span class="n">i</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

<div class="viewcode-block" id="OWFileExternal.ImportDialog.right_btn_click"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.ImportDialog.right_btn_click">[docs]</a>        <span class="k">def</span> <span class="nf">right_btn_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;End drawing line&quot;&quot;&quot;</span>
            <span class="n">button</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sel_right_pos</span> <span class="o">=</span> <span class="n">j</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateConnect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

<div class="viewcode-block" id="OWFileExternal.ImportDialog.mousePressEvent"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.ImportDialog.mousePressEvent">[docs]</a>        <span class="k">def</span> <span class="nf">mousePressEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Update connections and nodes&quot;&quot;&quot;</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">OWFileExternal</span><span class="o">.</span><span class="n">ImportDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">mousePressEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updateConnect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

<div class="viewcode-block" id="OWFileExternal.ImportDialog.updateConnect"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.ImportDialog.updateConnect">[docs]</a>        <span class="k">def</span> <span class="nf">updateConnect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;REorder items based on connection&quot;&quot;&quot;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">startPos</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel_left_pos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sel_right_pos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">itemAtPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sel_left_pos</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">itemAtPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sel_left_pos</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">itemAtPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sel_left_pos</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;--&gt;&#39;</span><span class="p">)</span>
                        <span class="n">unitWidget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">itemAtPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sel_left_pos</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
                        <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">itemAtPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sel_left_pos</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
                        <span class="n">right_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">itemAtPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sel_left_pos</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
                        <span class="n">right_old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">itemAtPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sel_right_pos</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
                        <span class="n">temp</span> <span class="o">=</span> <span class="n">right_old</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                        <span class="n">right_old</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">right_new</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
                        <span class="n">right_new</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">map_items</span><span class="p">[</span><span class="n">left</span><span class="o">.</span><span class="n">text</span><span class="p">()]</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">unitWidget</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">itemAtPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sel_left_pos</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">itemAtPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sel_left_pos</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">itemAtPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sel_left_pos</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                        <span class="n">left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_layout</span><span class="o">.</span><span class="n">itemAtPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sel_left_pos</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
                        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_items</span><span class="p">[</span><span class="n">left</span><span class="o">.</span><span class="n">text</span><span class="p">()]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel_left_pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sel_right_pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span></div>

<div class="viewcode-block" id="OWFileExternal.ImportDialog.mouseMoveEvent"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.ImportDialog.mouseMoveEvent">[docs]</a>        <span class="k">def</span> <span class="nf">mouseMoveEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Mouse move event:update line drawing&quot;&quot;&quot;</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">OWFileExternal</span><span class="o">.</span><span class="n">ImportDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">mouseMoveEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">endPos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span></div>

<div class="viewcode-block" id="OWFileExternal.ImportDialog.paintEvent"><a class="viewcode-back" href="../../../pylost_widgets.widgets.html#pylost_widgets.widgets.OWFileExternal.OWFileExternal.ImportDialog.paintEvent">[docs]</a>        <span class="k">def</span> <span class="nf">paintEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Draw line&quot;&quot;&quot;</span>
            <span class="n">QDialog</span><span class="o">.</span><span class="n">paintEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">startPos</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">endPos</span><span class="p">:</span>
                <span class="n">painter</span> <span class="o">=</span> <span class="n">QPainter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">pen</span> <span class="o">=</span> <span class="n">QPen</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">black</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">SolidLine</span><span class="p">)</span>
                <span class="n">painter</span><span class="o">.</span><span class="n">setPen</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>
                <span class="n">painter</span><span class="o">.</span><span class="n">drawLine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startPos</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">startPos</span><span class="o">.</span><span class="n">y</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">endPos</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">endPos</span><span class="o">.</span><span class="n">y</span><span class="p">())</span></div></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">pylost_widgets</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../pylost_widgets.html">pylost_widgets package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>