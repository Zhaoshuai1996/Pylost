
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pylost_widgets.util.MetrologyData &#8212; pylost_widgets  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/alabaster.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for pylost_widgets.util.MetrologyData</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Sequence</span>

<span class="kn">from</span> <span class="nn">astropy.units</span> <span class="kn">import</span> <span class="n">Quantity</span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">ast</span> <span class="kn">import</span> <span class="n">literal_eval</span> <span class="k">as</span> <span class="n">make_tuple</span>

<span class="kn">from</span> <span class="nn">pylost_widgets.util.ufunc_metrology_data</span> <span class="kn">import</span> <span class="n">get_params</span><span class="p">,</span> <span class="n">insert_default_items</span><span class="p">,</span> <span class="n">update_result</span>


<div class="viewcode-block" id="MetrologyData"><a class="viewcode-back" href="../../../pylost_widgets.util.html#pylost_widgets.util.MetrologyData.MetrologyData">[docs]</a><span class="k">class</span> <span class="nc">MetrologyData</span><span class="p">(</span><span class="n">Quantity</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to comprehensively represent metrology data inherited from numpy ndarray and astropy quantity</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_dim_detector</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_pix_size</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">dimensionless_unscaled</span>
    <span class="n">_axis_names</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_init_shape</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_index_list</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_axis_values</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_motors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_flags</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_items</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="MetrologyData.get_print_attributes"><a class="viewcode-back" href="../../../pylost_widgets.util.html#pylost_widgets.util.MetrologyData.MetrologyData.get_print_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">get_print_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get MetrologyData parameters in printable format.</span>

<span class="sd">        :return: Printable parameters</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">),</span>
            <span class="s1">&#39;pix_size&#39;</span><span class="p">:</span> <span class="s1">&#39; x &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pix_size</span><span class="p">),</span>
            <span class="s1">&#39;dim_detector&#39;</span><span class="p">:</span> <span class="s1">&#39; x &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">),</span>
            <span class="s1">&#39;axis_names&#39;</span><span class="p">:</span> <span class="s1">&#39; x &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_names</span><span class="p">),</span>
            <span class="s1">&#39;init_shape&#39;</span><span class="p">:</span> <span class="s1">&#39; x &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_shape</span><span class="p">),</span>
            <span class="s1">&#39;start_position&#39;</span><span class="p">:</span> <span class="s1">&#39; x &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_position</span><span class="p">),</span>
            <span class="s1">&#39;flags&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">),</span>
            <span class="s1">&#39;axis_values&#39;</span><span class="p">:</span> <span class="s1">&#39; x &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_values</span><span class="p">),</span>
            <span class="s1">&#39;motors&#39;</span><span class="p">:</span> <span class="s1">&#39;</span><span class="se">\n\t\t\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> : </span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">))</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">],</span> <span class="mi">5</span><span class="p">),</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">)</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="MetrologyData.get_attributes"><a class="viewcode-back" href="../../../pylost_widgets.util.html#pylost_widgets.util.MetrologyData.MetrologyData.get_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">get_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get MetrologyData parameters in savable format as attributes in hdf5.</span>

<span class="sd">        :return: Parameters</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;unit&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unit</span><span class="p">),</span>
            <span class="s1">&#39;dim_detector&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">),</span>
            <span class="s1">&#39;pix_size&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pix_size</span><span class="p">]),</span>
            <span class="s1">&#39;pix_size_unit&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">unit</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pix_size</span><span class="p">]),</span>
            <span class="s1">&#39;axis_names&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_names</span><span class="p">),</span>
            <span class="s1">&#39;init_shape&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_shape</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
            <span class="s1">&#39;index_list&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_list</span><span class="p">]),</span>
            <span class="s1">&#39;axis_values&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">([[</span><span class="nb">list</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">x</span><span class="o">.</span><span class="n">unit</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">)</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis_values</span><span class="p">]),</span>
            <span class="s1">&#39;motors&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">([{</span><span class="n">k</span><span class="p">:(</span><span class="nb">list</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span><span class="o">.</span><span class="n">item</span><span class="p">())</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">motors</span><span class="p">]),</span>
            <span class="s1">&#39;flags&#39;</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">)</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="MetrologyData.apply_attributes"><a class="viewcode-back" href="../../../pylost_widgets.util.html#pylost_widgets.util.MetrologyData.MetrologyData.apply_attributes">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">apply_attributes</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply MetrologyData from a dictionary</span>

<span class="sd">        :param data: Input data to add attributes</span>
<span class="sd">        :type data: np.ndarray</span>
<span class="sd">        :param attrs: Data attributes</span>
<span class="sd">        :type attrs: dict</span>
<span class="sd">        :return: Final data object</span>
<span class="sd">        :rtype: MetrologyData</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span>
        <span class="n">pix_size</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;pix_size&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pix_size</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">pix_size</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; x &#39;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">pix_size</span> <span class="o">=</span> <span class="p">[</span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pix_size</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; x &#39;</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pix_size</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">pix_size</span> <span class="o">=</span> <span class="p">[</span><span class="n">pix_size</span><span class="p">]</span>
        <span class="n">pix_unit</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;pix_size_unit&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;pix_size_unit&#39;</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="k">else</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">pix_size</span><span class="p">)</span>
        <span class="n">pix_size</span> <span class="o">=</span> <span class="p">[</span><span class="n">Quantity</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pix_size</span><span class="p">,</span> <span class="n">pix_unit</span><span class="p">)]</span>
        <span class="n">dim_detector</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;dim_detector&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;dim_detector&#39;</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="k">else</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">pix_size</span><span class="p">)</span>
        <span class="n">axis_names</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;axis_names&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;axis_names&#39;</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">axis_values</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;axis_values&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;axis_values&#39;</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">axis_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">axis_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">Quantity</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">==</span><span class="nb">str</span> <span class="k">else</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">axis_values</span><span class="p">]</span>
        <span class="n">motors</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;motors&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;motors&#39;</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">flags</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;flags&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;flags&#39;</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">MetrologyData</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">,</span> <span class="n">pix_size</span><span class="o">=</span><span class="n">pix_size</span><span class="p">,</span> <span class="n">dim_detector</span><span class="o">=</span><span class="n">dim_detector</span><span class="p">,</span> <span class="n">axis_names</span><span class="o">=</span><span class="n">axis_names</span><span class="p">,</span> <span class="n">axis_values</span><span class="o">=</span><span class="n">axis_values</span><span class="p">,</span> <span class="n">motors</span><span class="o">=</span><span class="n">motors</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="n">flags</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">init_shape</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;init_shape&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;init_shape&#39;</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">index_list</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;index_list&#39;</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;index_list&#39;</span> <span class="ow">in</span> <span class="n">attrs</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">data</span><span class="o">.</span><span class="n">_set_init_shape</span><span class="p">(</span><span class="n">init_shape</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">_set_index_list</span><span class="p">(</span><span class="n">index_list</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span></div>

    <span class="k">def</span> <span class="nf">_format_dim_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim_detector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Format detector dimensions object, e.g. [False, True, True].</span>

<span class="sd">        :param dim_detector: Detector dimensions</span>
<span class="sd">        :type dim_detector: tuple/list/np.ndarray</span>
<span class="sd">        :return: Formatted detector dimensions</span>
<span class="sd">        :rtype: list[bool]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_detector</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dim_detector</span><span class="p">)</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> \
                <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">bool</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dim_detector</span><span class="p">]):</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">dim_detector</span><span class="p">)</span>
        <span class="n">retArr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dim_detector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dim_detector</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">]:</span>
                <span class="n">dim_detector</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim_detector</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dim_detector</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dim_detector</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">]:</span>
                        <span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                        <span class="k">if</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">retArr</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">retArr</span><span class="p">):</span>
                            <span class="n">retArr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                    <span class="k">elif</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">retArr</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">retArr</span><span class="p">):</span> <span class="c1">#TODO: and type(val) is int</span>
                        <span class="n">retArr</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">retArr</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_format_index_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Format indices list along all data dimensions, e.g. [[0, 1, 2], [25, 26, 27, 28, 29, 30], [35, 36, 37, 38, 39]].</span>

<span class="sd">        :param index_list: List of arrays, each item is a array of indices along a dimension</span>
<span class="sd">        :type index_list: list</span>
<span class="sd">        :return: Formatted list</span>
<span class="sd">        :rtype: list[np.ndarray]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dim_nonzero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">index_list</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_list</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">index_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                        <span class="n">index_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">index_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">index_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                        <span class="n">index_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">!=</span> <span class="n">x</span><span class="p">:</span>
                        <span class="n">index_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">index_list</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dim_nonzero</span><span class="p">):</span>
                <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">]</span>
                <span class="n">i</span><span class="o">=</span><span class="mi">0</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">dim_nonzero</span><span class="p">:</span>
                    <span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">index_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">i</span><span class="o">+=</span><span class="mi">1</span>
                <span class="k">return</span> <span class="n">a</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">index_list</span><span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">:]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_list</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[:(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">index_list</span><span class="p">))]]</span>
                <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">index_list</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exception while formatting MetrologyData index list&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_format_axis_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axisNames</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Format axis names for all dimensions, e.g. [Motor, Y, X].</span>

<span class="sd">        :param axisNames: Axis names array</span>
<span class="sd">        :type axisNames: tuple/list/np.ndarray</span>
<span class="sd">        :return: Formatted axis names</span>
<span class="sd">        :rtype: list[str]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axisNames</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">axisNames</span><span class="p">)</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">axisNames</span><span class="p">)</span>
        <span class="n">retArr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span>
        <span class="k">if</span> <span class="n">axisNames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axisNames</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axisNames</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">retArr</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">retArr</span><span class="p">):</span>
                    <span class="n">retArr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">return</span> <span class="n">retArr</span>

    <span class="k">def</span> <span class="nf">_format_axis_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axisVals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Format axis values, e..g [&#39;motor_X&#39;, &#39;&#39;, &#39;&#39;] where motor_X name exists in self._motors.</span>

<span class="sd">        :param axisVals: Axis values array</span>
<span class="sd">        :type axisVals: tuple/list/np.ndarray</span>
<span class="sd">        :return: Formatted axis values</span>
<span class="sd">        :rtype: list[str/np.ndarray]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axisVals</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">axisVals</span><span class="p">)</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">axisVals</span><span class="p">)</span>
        <span class="n">retArr</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span>
        <span class="k">if</span> <span class="n">axisVals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axisVals</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axisVals</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">retArr</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">retArr</span><span class="p">):</span>
                    <span class="n">retArr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">return</span> <span class="n">retArr</span>

    <span class="k">def</span> <span class="nf">_format_motors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motors</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Format motors list. Each item is a dictionary with motor name, values, unit and axis fields.</span>

<span class="sd">        :param motors: Motors array</span>
<span class="sd">        :type motors: tuple/list/np.ndarray</span>
<span class="sd">        :return: Formatted motors array</span>
<span class="sd">        :rtype: list[dict]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">motors</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">motors</span><span class="p">]):</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">motors</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">motors</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">motors</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_format_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flags</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Format flags dictionary, e.g. {flip_y_display:True}.</span>

<span class="sd">        :param flags: Flags dictionary</span>
<span class="sd">        :type flags: dict</span>
<span class="sd">        :return: Formatted flags</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flags</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">flags</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_format_init_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_shape</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Format initial shape, before applying any masks.</span>

<span class="sd">        :param init_shape: Initial shape array</span>
<span class="sd">        :type init_shape: tuple/list/np.ndarray</span>
<span class="sd">        :return: Formatted init shape</span>
<span class="sd">        :rtype: list[int]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init_shape</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">init_shape</span><span class="p">)</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">init_shape</span><span class="p">)</span>
        <span class="n">retArr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">init_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init_shape</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">init_shape</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">j</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">retArr</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">retArr</span><span class="p">):</span>
                    <span class="n">retArr</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">return</span> <span class="n">retArr</span>

    <span class="k">def</span> <span class="nf">_format_pix_sz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pix_size</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Format pixel size array. It is set to 1 for non-detector dimensions.</span>

<span class="sd">        :param pix_size: Pixel size</span>
<span class="sd">        :type pix_size: tuple/list/np.ndarray</span>
<span class="sd">        :param unit: Pixel units</span>
<span class="sd">        :type unit: str/astropy.units.Unit</span>
<span class="sd">        :return: Formatted pixel size array</span>
<span class="sd">        :rtype: list[Quantity]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pix_size</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">pix_size</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
            <span class="n">pix_size</span> <span class="o">=</span> <span class="p">[</span><span class="n">pix_size</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pix_size</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">pix_size</span><span class="p">)</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span> \
                <span class="ow">and</span> <span class="nb">all</span><span class="p">([</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Quantity</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pix_size</span><span class="p">]):</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">pix_size</span><span class="p">)</span>

        <span class="n">retArr</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">dimensionless_unscaled</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span>
        <span class="n">retArr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">retArr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">Quantity</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pix_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Dimensions of detector are not selected&#39;</span><span class="p">)</span>

            <span class="n">pix_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pix_sz_quantity</span><span class="p">(</span><span class="n">pix_size</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>
            <span class="n">retArr</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">]</span> <span class="o">=</span> <span class="n">pix_size</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">retArr</span><span class="p">)</span>

<div class="viewcode-block" id="MetrologyData.get_pix_sz_quantity"><a class="viewcode-back" href="../../../pylost_widgets.util.html#pylost_widgets.util.MetrologyData.MetrologyData.get_pix_sz_quantity">[docs]</a>    <span class="k">def</span> <span class="nf">get_pix_sz_quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pix_size</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get pixel size as list of astropy quantities.</span>

<span class="sd">        :param pix_size: pixel size array</span>
<span class="sd">        :type pix_size: tuple/list/np.ndarray</span>
<span class="sd">        :param unit: pixel unit</span>
<span class="sd">        :type unit: str/astropy.units.Unit</span>
<span class="sd">        :return: Pixel size as quantities</span>
<span class="sd">        :rtype: list[Quantity]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retArr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pix_size</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">pix_size</span><span class="p">:</span>
                <span class="n">retArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Quantity</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">pix_size</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
            <span class="n">retArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">pix_size</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pix_size</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">):</span>
            <span class="n">retArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pix_size</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pix_size</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">retArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">(</span><span class="n">pix_size</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">retArr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_pix_sz_quantity</span><span class="p">(</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">pix_size</span><span class="p">),</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unable to parse string&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">retArr</span></div>

<div class="viewcode-block" id="MetrologyData.get_pix_scale"><a class="viewcode-back" href="../../../pylost_widgets.util.html#pylost_widgets.util.MetrologyData.MetrologyData.get_pix_scale">[docs]</a>    <span class="k">def</span> <span class="nf">get_pix_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get pixel scale, i.e. scale when units are converted to SI.</span>

<span class="sd">        :return: Pixel scale</span>
<span class="sd">        :rtype: list[float]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">axis_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_axis_val_items_detector</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">)</span> <span class="ow">and</span> <span class="kc">False</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">:</span> <span class="c1"># only detector data</span>
            <span class="n">pix_scale</span> <span class="o">=</span> <span class="p">[</span><span class="n">axis_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">si</span><span class="o">.</span><span class="n">scale</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axis_vals</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># last one or two dimensions depending on ndim</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">pix_scale</span> <span class="o">=</span> <span class="p">[</span><span class="n">axis_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)]</span> <span class="c1">#.si.scale]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pix_scale</span> <span class="o">=</span> <span class="p">[</span><span class="n">axis_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="c1">#.si.scale</span>
        <span class="k">return</span> <span class="n">pix_scale</span></div>

<div class="viewcode-block" id="MetrologyData.get_axis_units_detector"><a class="viewcode-back" href="../../../pylost_widgets.util.html#pylost_widgets.util.MetrologyData.MetrologyData.get_axis_units_detector">[docs]</a>    <span class="k">def</span> <span class="nf">get_axis_units_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get axis units only along detector dimensions. Useful if axis values are specified instead if pixel size.</span>

<span class="sd">        :return: Units</span>
<span class="sd">        :rtype: astropy.units.Unit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">axis_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_axis_val_items_detector</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">)</span> <span class="ow">and</span> <span class="kc">False</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">:</span> <span class="c1"># only detector data</span>
            <span class="n">units</span> <span class="o">=</span> <span class="p">[</span><span class="n">axis_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axis_vals</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span> <span class="c1"># last one or two dimensions depending on ndim</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">units</span> <span class="o">=</span> <span class="p">[</span><span class="n">axis_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">units</span> <span class="o">=</span> <span class="p">[</span><span class="n">axis_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">unit</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">units</span></div>

<div class="viewcode-block" id="MetrologyData.get_axis_val_items_detector"><a class="viewcode-back" href="../../../pylost_widgets.util.html#pylost_widgets.util.MetrologyData.MetrologyData.get_axis_val_items_detector">[docs]</a>    <span class="k">def</span> <span class="nf">get_axis_val_items_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get axis values along detector dimensions.</span>

<span class="sd">        :return: Axis values</span>
<span class="sd">        :rtype: list[Quantity[np.ndarray]]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">axis_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_axis_val_items</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">)</span> <span class="ow">and</span> <span class="kc">False</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">:</span>
            <span class="n">axis_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">axis_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">axis_vals</span></div>

<div class="viewcode-block" id="MetrologyData.get_axis_val_items"><a class="viewcode-back" href="../../../pylost_widgets.util.html#pylost_widgets.util.MetrologyData.MetrologyData.get_axis_val_items">[docs]</a>    <span class="k">def</span> <span class="nf">get_axis_val_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get axis values for all dimensions. If an item is string look for corresponding values in self._motors. If for certain detector axis no values are provided, build using pixel size.</span>

<span class="sd">        :return: Axis values</span>
<span class="sd">        :rtype: list[Quantity[np.ndarray]]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">retArr</span> <span class="o">=</span> <span class="p">[</span><span class="n">Quantity</span><span class="p">([])]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axis_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axis_values</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">item</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_motors</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">item</span><span class="p">:</span>
                                <span class="n">temp</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="c1"># Dimension size is same as motor array size</span>
                                    <span class="n">retArr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">])</span>
                                <span class="c1"># elif np.prod(self.shape_non_detector) == len(flatten_list(temp)): # Each motor position correspond to full non detector size</span>
                                <span class="c1">#     pass</span>
                                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span><span class="o">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                                    <span class="n">retArr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">temp</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">unit</span><span class="o">=</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                            <span class="n">retArr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
                        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                            <span class="n">retArr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pix_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1">#     if self._index_list is not None and len(self._index_list[i]) == self.shape[i]:</span>
                    <span class="c1">#         retArr[i] = self._pix_size[i] * self._index_list[i]</span>
                    <span class="c1">#     else:</span>
                        <span class="n">retArr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pix_size</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                        <span class="c1"># retArr[i] = retArr[i] - np.nanmean(retArr[i])</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">retArr</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dim_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Detector dimensions boolean array&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pix_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pixel size array&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pix_size</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pix_size_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pixel sizes for detector dimensions&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pix_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">Quantity</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pix_size</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">init_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initial data shape&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_shape</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">index_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Indices list&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">axis_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Axis names list&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axis_names</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">axis_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Axis values list&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axis_values</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">axis_names_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Axis names for detector dimensions&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axis_names</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">Quantity</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axis_names</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">index_list_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Indices list for detector dimensions&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">start_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Start position of data on detector (in detector units)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pix_size</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">start_position_pix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Start position of data on detector (in pixels)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">center</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Center position relative to data size (in detector units)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pix_size</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">center_pix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Center position relative to data size (in pixels)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">center_absolute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Center position relative to initial/full size (in detector dimensions)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pix_size</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">center_absolute_pix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Center position relative to initial/full size (in pixels)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size_init_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initial size of detector&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pix_size</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">size_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Current size of detector data&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">pix_size</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Current size of detector data&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">shape_non_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Data shape along non-detector dimensions&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">))[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">motors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Motor list&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_motors</span>

    <span class="k">def</span> <span class="nf">_set_dim_detector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim_detector</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_dim_detector</span><span class="p">(</span><span class="n">dim_detector</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_pix_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pix_size</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pix_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_pix_sz</span><span class="p">(</span><span class="n">pix_size</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_init_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_init_shape</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_init_shape</span><span class="p">(</span><span class="n">_init_shape</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_index_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index_list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_index_list</span><span class="p">(</span><span class="n">index_list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_axis_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis_names</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axis_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_axis_names</span><span class="p">(</span><span class="n">axis_names</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_axis_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis_vals</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axis_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_axis_values</span><span class="p">(</span><span class="n">axis_vals</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_motors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motors</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_motors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_motors</span><span class="p">(</span><span class="n">motors</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_flags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flags</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_flags</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_start_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_start_pos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        To update start position, indices list has to be updated, i.e. start pixel is added to index list along each detector dimension.</span>

<span class="sd">        :param new_start_pos: New start position</span>
<span class="sd">        :type new_start_pos: list</span>
<span class="sd">        :return: Flag whether the new position is set</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">pidx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_position_pix</span>
        <span class="n">nidx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">narr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">new_start_pos</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">narr</span><span class="p">]):</span>
            <span class="n">narr</span> <span class="o">=</span> <span class="n">narr</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">pix_size_detector</span>
        <span class="n">nidx_det</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">narr</span><span class="p">]</span>
        <span class="n">nidx</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">]</span> <span class="o">=</span> <span class="n">nidx_det</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">]</span>
        <span class="n">full_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">init_shape</span><span class="p">)[</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_detector</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nidx_det</span> <span class="o">+</span> <span class="n">size</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">full_size</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">idx_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_list</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ndim</span><span class="p">):</span>
                <span class="n">idx_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="n">nidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">pidx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_list</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_index_list</span><span class="p">(</span><span class="n">idx_list</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="MetrologyData.update_motors"><a class="viewcode-back" href="../../../pylost_widgets.util.html#pylost_widgets.util.MetrologyData.MetrologyData.update_motors">[docs]</a>    <span class="k">def</span> <span class="nf">update_motors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">motors</span><span class="p">,</span> <span class="n">add_if_not</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update motors array</span>

<span class="sd">        :param motors: Array with new/updated motor values</span>
<span class="sd">        :type motors: list[dict]</span>
<span class="sd">        :param add_if_not: Add if motor not existing</span>
<span class="sd">        :type add_if_not: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">motors</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_motor</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;axis&#39;</span><span class="p">],</span> <span class="n">add_if_not</span><span class="o">=</span><span class="n">add_if_not</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetrologyData.update_motor"><a class="viewcode-back" href="../../../pylost_widgets.util.html#pylost_widgets.util.MetrologyData.MetrologyData.update_motor">[docs]</a>    <span class="k">def</span> <span class="nf">update_motor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">3</span><span class="p">,</span> <span class="n">add_if_not</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update a motor</span>

<span class="sd">        :param name: Name of motor</span>
<span class="sd">        :type name: str</span>
<span class="sd">        :param values: Motor values</span>
<span class="sd">        :type values: np.ndarray</span>
<span class="sd">        :param unit: Motor unit</span>
<span class="sd">        :type unit: str</span>
<span class="sd">        :param axis: Associated data axis</span>
<span class="sd">        :type axis: int</span>
<span class="sd">        :param add_if_not: Add motor if not existing</span>
<span class="sd">        :type add_if_not: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">has_name</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_motors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">name</span><span class="p">:</span>
                <span class="n">has_name</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">m</span><span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
                <span class="n">m</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_name</span> <span class="ow">and</span> <span class="n">add_if_not</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_motor</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetrologyData.add_motor"><a class="viewcode-back" href="../../../pylost_widgets.util.html#pylost_widgets.util.MetrologyData.MetrologyData.add_motor">[docs]</a>    <span class="k">def</span> <span class="nf">add_motor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new motor</span>

<span class="sd">        :param name: Name of motor</span>
<span class="sd">        :type name: str</span>
<span class="sd">        :param values: Motor values</span>
<span class="sd">        :type values: np.ndarray</span>
<span class="sd">        :param unit: Motor unit</span>
<span class="sd">        :type unit: str</span>
<span class="sd">        :param axis: Associated data axis</span>
<span class="sd">        :type axis: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="n">name</span><span class="p">,</span>
             <span class="s1">&#39;values&#39;</span><span class="p">:</span><span class="n">values</span><span class="p">,</span>
             <span class="s1">&#39;axis&#39;</span><span class="p">:</span><span class="n">axis</span><span class="p">,</span>
             <span class="s1">&#39;unit&#39;</span><span class="p">:</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">unit</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_motors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetrologyData.add_flag"><a class="viewcode-back" href="../../../pylost_widgets.util.html#pylost_widgets.util.MetrologyData.MetrologyData.add_flag">[docs]</a>    <span class="k">def</span> <span class="nf">add_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new flag.</span>

<span class="sd">        :param name: Name of the flag</span>
<span class="sd">        :type name: str</span>
<span class="sd">        :param val: True or false</span>
<span class="sd">        :type val: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">val</span><span class="p">)</span></div>

<div class="viewcode-block" id="MetrologyData.del_flag"><a class="viewcode-back" href="../../../pylost_widgets.util.html#pylost_widgets.util.MetrologyData.MetrologyData.del_flag">[docs]</a>    <span class="k">def</span> <span class="nf">del_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete a flag.</span>

<span class="sd">        :param name: Name of the flag</span>
<span class="sd">        :type name: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div>

<div class="viewcode-block" id="MetrologyData.get_flag"><a class="viewcode-back" href="../../../pylost_widgets.util.html#pylost_widgets.util.MetrologyData.MetrologyData.get_flag">[docs]</a>    <span class="k">def</span> <span class="nf">get_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get flag value.</span>

<span class="sd">        :param name: Name of the flag</span>
<span class="sd">        :type name: str</span>
<span class="sd">        :return: Flag value</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_flag</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="MetrologyData.has_flag"><a class="viewcode-back" href="../../../pylost_widgets.util.html#pylost_widgets.util.MetrologyData.MetrologyData.has_flag">[docs]</a>    <span class="k">def</span> <span class="nf">has_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if MetrologyData has the flag</span>

<span class="sd">        :param name: Name of the flag</span>
<span class="sd">        :type name: str</span>
<span class="sd">        :return: Has the flag or not</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">)</span></div>

    <span class="c1"># Base class methods</span>
    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pix_size</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">pix_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dim_detector</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">motors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">subok</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new MetrologyData object and initialize it.</span>

<span class="sd">        :param value: Value stored in MetrologyData</span>
<span class="sd">        :type value: np.ndarray</span>
<span class="sd">        :param unit: Units</span>
<span class="sd">        :type unit: str/astropy.units.Unit</span>
<span class="sd">        :param pix_size: Pixel size</span>
<span class="sd">        :type pix_size: float/list</span>
<span class="sd">        :param pix_unit: Pixel unit</span>
<span class="sd">        :type pix_unit: str</span>
<span class="sd">        :param dim_detector: Detector dimensions</span>
<span class="sd">        :type dim_detector: list[bool]</span>
<span class="sd">        :param axis_names: Axis names</span>
<span class="sd">        :type axis_names: list[str]</span>
<span class="sd">        :param axis_values: Axis values</span>
<span class="sd">        :type axis_values: list[str/np.ndarray]</span>
<span class="sd">        :param motors: Motors list</span>
<span class="sd">        :type motors: list[dict]</span>
<span class="sd">        :param flags: Flags</span>
<span class="sd">        :type flags: dict</span>
<span class="sd">        :param subok: Used by astropy.Quantity class</span>
<span class="sd">        :type subok: bool</span>
<span class="sd">        :param kwargs: Additional arguments used by astropy.Quantity class</span>
<span class="sd">        :type kwargs: bool</span>
<span class="sd">        :return: New data object</span>
<span class="sd">        :rtype: MetrologyData</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">Quantity</span><span class="p">,</span> <span class="n">MetrologyData</span><span class="p">)):</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">unit</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span>
        <span class="n">quantity</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">unit</span><span class="p">,</span> <span class="n">subok</span><span class="o">=</span><span class="n">subok</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">quantity</span><span class="o">.</span><span class="n">_init_shape</span> <span class="o">=</span> <span class="n">quantity</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">quantity</span><span class="o">.</span><span class="n">_set_axis_names</span><span class="p">(</span><span class="n">axis_names</span><span class="p">)</span>
        <span class="n">quantity</span><span class="o">.</span><span class="n">_set_axis_values</span><span class="p">(</span><span class="n">axis_values</span><span class="p">)</span>
        <span class="n">quantity</span><span class="o">.</span><span class="n">_set_dim_detector</span><span class="p">(</span><span class="n">dim_detector</span><span class="p">)</span>
        <span class="n">quantity</span><span class="o">.</span><span class="n">_set_pix_size</span><span class="p">(</span><span class="n">pix_size</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="n">pix_unit</span><span class="p">)</span>
        <span class="n">quantity</span><span class="o">.</span><span class="n">_set_index_list</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">quantity</span><span class="o">.</span><span class="n">shape</span><span class="p">])</span>
        <span class="n">quantity</span><span class="o">.</span><span class="n">_set_motors</span><span class="p">(</span><span class="n">motors</span><span class="p">)</span>
        <span class="n">quantity</span><span class="o">.</span><span class="n">_set_flags</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">quantity</span>

    <span class="k">def</span> <span class="nf">__array_finalize__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finalize function after numpy operation.</span>

<span class="sd">        :param obj: Data object</span>
<span class="sd">        :type obj: MetrologyData</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If we&#39;re a new object or viewing an Quantity, nothing has to be done.</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span> <span class="ow">is</span> <span class="n">Quantity</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;_unit&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;_dim_detector&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pix_size</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;_pix_size&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pix_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_shape</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;_init_shape&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_init_shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axis_names</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;_axis_names&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axis_names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axis_values</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;_axis_values&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axis_values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;_index_list&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_motors</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;_motors&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_motors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;_flags&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s1">&#39;_items&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_items</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_copy_items</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">MetrologyData</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_slice</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MetrologyData--&gt;__array_finalize__:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="n">items</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_slice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">items</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update metrology data parameters after a slicing operation.</span>

<span class="sd">        :param items: Slicing items</span>
<span class="sd">        :type items: np.bool / np.ndarray / tuple / list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nonzero</span><span class="p">())</span>
            <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">items</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">items</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">items</span><span class="p">):</span>
            <span class="n">non_items</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">]</span>
            <span class="n">items</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">items</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">non_items</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nonzero</span><span class="p">())</span>
                <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">non_items</span><span class="p">):</span>
                <span class="n">items</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">items</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">(</span><span class="n">items</span><span class="p">,)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">items</span><span class="p">):</span>
            <span class="n">items</span> <span class="o">=</span> <span class="p">(</span><span class="n">items</span><span class="p">,)</span>

        <span class="n">terms</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="bp">Ellipsis</span><span class="p">:</span>
                <span class="n">terms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span><span class="p">)</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_insert_default_items</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">:</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">item</span><span class="p">):</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">terms</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">terms</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">terms</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span><span class="p">):</span>
            <span class="n">del_idx</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
                    <span class="n">del_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_delete_items</span><span class="p">(</span><span class="n">del_idx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_items</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_insert_default_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert default parameters along a given axis.</span>

<span class="sd">        :param i: Axis position</span>
<span class="sd">        :type i: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pix_size</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">(</span><span class="mf">1.0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axis_names</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axis_values</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_shape</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_delete_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete parameters along given axis.</span>

<span class="sd">        :param idx: Axis position</span>
<span class="sd">        :type idx: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_del_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_del_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pix_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_del_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pix_size</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axis_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_del_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axis_names</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axis_values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_del_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axis_values</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_del_item</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_shape</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_copy_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deep copy metrology data parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pix_size</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pix_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axis_names</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axis_names</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axis_values</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axis_values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_shape</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_motors</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_motors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flags</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">is_dim_detector</span><span class="p">,</span> <span class="n">pix_size</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update parameters along a given axis.</span>

<span class="sd">        :param i: Axis index</span>
<span class="sd">        :type i: int</span>
<span class="sd">        :param indices: Indices for the axis</span>
<span class="sd">        :type indices:</span>
<span class="sd">        :param is_dim_detector: Is the axes for detector dimension</span>
<span class="sd">        :type is_dim_detector: bool</span>
<span class="sd">        :param pix_size: Pixel size</span>
<span class="sd">        :type pix_size: float/Quantity[float]</span>
<span class="sd">        :param axis: Axis</span>
<span class="sd">        :type axis: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">is_dim_detector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pix_size</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Quantity</span><span class="p">(</span><span class="n">pix_size</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axis_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">axis</span>

    <span class="k">def</span> <span class="nf">_del_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete parameter values along given axis</span>

<span class="sd">        :param param: Parameter values to update</span>
<span class="sd">        :type param: list</span>
<span class="sd">        :param idx: Axis</span>
<span class="sd">        :type idx: int</span>
<span class="sd">        :return: Updated parameter values</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">param</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">param</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__array_ufunc__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function called after array_finalize in a numpy operation. Final array is converted to MetrologyData</span>

<span class="sd">        :param function: Numpy operation/function which was applied to data</span>
<span class="sd">        :type function: Callable</span>
<span class="sd">        :param method:</span>
<span class="sd">        :type method:</span>
<span class="sd">        :param inputs: Inputs to the function</span>
<span class="sd">        :type inputs: list</span>
<span class="sd">        :param kwargs: Additional arguments</span>
<span class="sd">        :type kwargs: dict</span>
<span class="sd">        :return: Result as a MetrologyData</span>
<span class="sd">        :rtype: MetrologyData</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># arrays = []</span>
        <span class="c1"># for input_ in inputs:</span>
        <span class="c1">#     arrays.append(input_.view(Quantity) if type(input_) is MetrologyData else input_)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__array_ufunc__</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">NotImplemented</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_metrology</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="MetrologyData.result_metrology"><a class="viewcode-back" href="../../../pylost_widgets.util.html#pylost_widgets.util.MetrologyData.MetrologyData.result_metrology">[docs]</a>    <span class="k">def</span> <span class="nf">result_metrology</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="n">result_new</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_metrology</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    <span class="n">result_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">result_new</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">(</span><span class="n">MetrologyData</span><span class="p">,</span> <span class="n">Quantity</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Quantity</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">MetrologyData</span><span class="p">)</span>
                <span class="n">nin</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span> <span class="c1">#function.nin</span>
                <span class="n">ndim</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span>
                <span class="n">params</span> <span class="o">=</span> <span class="n">get_params</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">nin</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nin</span><span class="p">):</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">MetrologyData</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="n">ndim</span><span class="p">:</span>
                                <span class="n">ndim</span> <span class="o">=</span> <span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span>
                    <span class="k">if</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ndim</span> <span class="o">-</span> <span class="n">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span><span class="p">):</span>
                            <span class="n">insert_default_items</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>

                <span class="k">return</span> <span class="n">update_result</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="o">*</span><span class="n">inputs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MetrologyData--&gt;result_metrology:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span></div>

    <span class="k">def</span> <span class="nf">__quantity_subclass__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unit</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Specifies the current class as Quantity subclass</span>

<span class="sd">        :param unit: Units</span>
<span class="sd">        :type unit: str/astropy.units.Unit</span>
<span class="sd">        :return: MetrologyData class, True</span>
<span class="sd">        :rtype: Class, bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MetrologyData</span><span class="p">,</span> <span class="kc">True</span>

<div class="viewcode-block" id="MetrologyData.copy_to"><a class="viewcode-back" href="../../../pylost_widgets.util.html#pylost_widgets.util.MetrologyData.MetrologyData.copy_to">[docs]</a>    <span class="k">def</span> <span class="nf">copy_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extend current numpy array with paramters from Metrology Data object.</span>

<span class="sd">        :param obj: Original object</span>
<span class="sd">        :type obj: np.ndarray</span>
<span class="sd">        :return: Extended object</span>
<span class="sd">        :rtype: MetrologyData</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">unit</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Quantity</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">MetrologyData</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_set_unit</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_set_dim_detector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_set_pix_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pix_size</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_set_index_list</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_index_list</span><span class="p">))</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_set_axis_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axis_names</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_set_axis_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axis_values</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_set_init_shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init_shape</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_set_motors</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_motors</span><span class="p">))</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_set_flags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div>

<div class="viewcode-block" id="MetrologyData.copy_to_detector_format"><a class="viewcode-back" href="../../../pylost_widgets.util.html#pylost_widgets.util.MetrologyData.MetrologyData.copy_to_detector_format">[docs]</a>    <span class="k">def</span> <span class="nf">copy_to_detector_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extend current numpy array with paramters from Metrology Data object for only detector dimensions.</span>

<span class="sd">        :param obj: Original object</span>
<span class="sd">        :type obj: np.ndarray</span>
<span class="sd">        :return: Extended object</span>
<span class="sd">        :rtype: MetrologyData</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">obj</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">unit</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span> <span class="ow">is</span> <span class="n">Quantity</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">unit</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">MetrologyData</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_set_unit</span><span class="p">(</span><span class="n">unit</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_set_dim_detector</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dim_detector</span> <span class="k">if</span> <span class="n">x</span><span class="p">])</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_set_pix_size</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pix_size_detector</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_set_index_list</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_set_axis_names</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">axis_names_detector</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_set_axis_values</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_set_motors</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_motors</span><span class="p">))</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_set_flags</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flags</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">pylost_widgets</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../pylost_widgets.html">pylost_widgets package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>