
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>orangewidget.utils.messages &#8212; pylost_widgets  documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for orangewidget.utils.messages</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Mixin class for errors, warnings and information</span>

<span class="sd">A class derived from `OWBaseWidget` can include member classes `Error`, `Warning`</span>
<span class="sd">and `Information`, derived from the same-named `OWBaseWidget` classes. Each of</span>
<span class="sd">those contains members that are instances of `UnboundMsg`, which is, for</span>
<span class="sd">convenience, also exposed as `Orange.widgets.widget.Msg`. These members</span>
<span class="sd">represent all possible errors, like `Error.no_discrete_vars`, with exception</span>
<span class="sd">of the deprecated old-style errors.</span>

<span class="sd">When the widget is instantiated, classes `Error`, `Warning` and `Information`</span>
<span class="sd">are instantiated and bound to the widget: their attribute `widget` is the link</span>
<span class="sd">to the widget that instantiated them. Their member messages are replaced with</span>
<span class="sd">instances of `_BoundMsg`, which are bound to the group through the `group`</span>
<span class="sd">attribute.</span>

<span class="sd">A message is shown by calling, e.g. `self.Error.no_discrete_vars()`. The call</span>
<span class="sd">formats the message and tells the group to activate it::</span>

<span class="sd">    self.formatted = self.format(*args, **kwargs)</span>
<span class="sd">    self.group.activate_msg(self)</span>

<span class="sd">The group adds it to the dictionary of active messages (attribute `active`)</span>
<span class="sd">and emits the signal `messageActivated`. The signal is connected to the</span>
<span class="sd">widget&#39;s method `update_widget_state`, which shows the message in the bar, and</span>
<span class="sd">`WidgetManager`&#39;s `__on_widget_state_changed`, which manages the icons on the</span>
<span class="sd">canvas.</span>

<span class="sd">Clearing messages work analogously.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="k">import</span> <span class="n">attrgetter</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="k">import</span> <span class="n">warn</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="k">import</span> <span class="n">getattr_static</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">AnyQt.QtWidgets</span> <span class="k">import</span> <span class="n">QStyle</span><span class="p">,</span> <span class="n">QSizePolicy</span>

<span class="kn">from</span> <span class="nn">orangewidget</span> <span class="k">import</span> <span class="n">gui</span>
<span class="kn">from</span> <span class="nn">orangewidget.utils.messagewidget</span> <span class="k">import</span> <span class="n">MessagesWidget</span>


<span class="k">class</span> <span class="nc">UnboundMsg</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The class used for declaring messages in classes derived from</span>
<span class="sd">    MessageGroup. When instantiating the message group, instances of this</span>
<span class="sd">    class are replaced by instances of `_BoundMsg` that are bound to the group.</span>

<span class="sd">    Note: this class is aliased to `Orange.widgets.widget.Msg`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_BoundMsg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>

    <span class="c1"># The method is implemented in _BoundMsg</span>
    <span class="c1"># pylint: disable=unused-variable</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">shown</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show the message, or hide it if `show` is set `False`</span>
<span class="sd">        `*args` and `**kwargs` are passed to the `format` method.</span>

<span class="sd">        Args:</span>
<span class="sd">            shown (bool): keyword-only argument that can be set to `False` to</span>
<span class="sd">                hide the message</span>
<span class="sd">            exc_info (Union[BaseException, bool, None]): Optional exception</span>
<span class="sd">                instance whose traceback to store in the message. Can also be</span>
<span class="sd">                a `True` value in which case the exception is retrieved from</span>
<span class="sd">                sys.exc_info()</span>
<span class="sd">            *args: arguments for `format`</span>
<span class="sd">            **kwargs: keyword arguments for `format`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Message is not bound&quot;</span><span class="p">)</span>

    <span class="c1"># The method is implemented in _BoundMsg</span>
    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the message.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Message is not bound&quot;</span><span class="p">)</span>

    <span class="c1"># The method is implemented in _BoundMsg</span>
    <span class="k">def</span> <span class="nf">is_shown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return True if message is currently displayed.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Message is not bound&quot;</span><span class="p">)</span>

    <span class="c1"># Ensure that two instance of message are always different</span>
    <span class="c1"># In particular, there may be multiple messages &quot;{}&quot;.</span>
    <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="ow">is</span> <span class="n">other</span>


<span class="k">class</span> <span class="nc">_BoundMsg</span><span class="p">(</span><span class="n">UnboundMsg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A message that is bound to the group.</span>

<span class="sd">    Instances of this class provide the call operator for raising the message,</span>
<span class="sd">    and method `clear` for removing it.</span>

<span class="sd">    When the message is called, the arguments are passed to the message&#39;s</span>
<span class="sd">    format` method and the resulting string is stored in the attribute</span>
<span class="sd">    `formatted`.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        group (MessageGroup): the group to which this message belongs</span>
<span class="sd">        formatted (str): formatted message</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">unbound_msg</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">UnboundMsg</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">unbound_msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">group</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatted</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tb</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># type: Optional[str]</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">shown</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tb</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">shown</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">formatted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">exc_info</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc_info</span><span class="p">,</span> <span class="ne">BaseException</span><span class="p">):</span>
                    <span class="n">exc_info</span> <span class="o">=</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">exc_info</span><span class="p">),</span> <span class="n">exc_info</span><span class="p">,</span>
                                <span class="n">exc_info</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">exc_info</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                    <span class="n">exc_info</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">exc_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">tb</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exception</span><span class="p">(</span><span class="o">*</span><span class="n">exc_info</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">activate_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">deactivate_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_shown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">active</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatted</span>


<span class="k">class</span> <span class="nc">_OldStyleMsg</span><span class="p">(</span><span class="n">_BoundMsg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class for handling the old-style messages.</span>

<span class="sd">    Instances of this class are instantiated by the old methods `error`,</span>
<span class="sd">    `warning` and `information` and added to the list of active messages,</span>
<span class="sd">    with their old-style id&#39;s as keys. Instance of `_OldStyleMsg` are not</span>
<span class="sd">    members of message groups.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">group</span><span class="p">):</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="n">_BoundMsg</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatted</span> <span class="o">=</span> <span class="n">text</span>
        <span class="k">return</span> <span class="bp">self</span>


<span class="k">class</span> <span class="nc">MessageGroup</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A groups of messages, e.g. errors, warnings, information messages</span>

<span class="sd">    Widget&#39;s `__init__` searches for instances of this class among the widget&#39;s</span>
<span class="sd">    class member and instantiates them.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        widget (widget.OWBaseWidget): the widget instance to which the group belongs</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span> <span class="o">=</span> <span class="n">widget</span>
        <span class="c1"># Note: active messages are stored in the dictionary, in which</span>
        <span class="c1"># the key and the corresponding value are one and the same object,</span>
        <span class="c1"># except for old-style classes, for which the key is an (old-style)</span>
        <span class="c1"># id. When we remove support for old-style messages (Orange 4),</span>
        <span class="c1"># this dictionary  can be replaced with a set.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_active</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_general</span> <span class="o">=</span> <span class="n">UnboundMsg</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_bind_messages</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sequence[_BoundMsg]: Sequence of all currently active messages.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_bind_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># type(self).__dict__ wouldn&#39;t return inherited messages, hence dir</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">UnboundMsg</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">add_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add and bind message to a group that is already instantiated</span>
<span class="sd">        and bound.</span>

<span class="sd">        If the message with that name already exists, the method does nothing.</span>
<span class="sd">        The method is used by helpers like this (simplified) one::</span>

<span class="sd">            def check_results(results, msg_group):</span>
<span class="sd">                msg_group.add_message(&quot;invalid_results&quot;,</span>
<span class="sd">                                      &quot;Results do not include any data&quot;)</span>
<span class="sd">                msg_group.invalid_results.clear()</span>
<span class="sd">                if results.data is None:</span>
<span class="sd">                    msg_group.invalid_results()</span>

<span class="sd">        The helper is called from several widgets with</span>
<span class="sd">        `check_results(results, self.Error)`</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): the name of the member with the message</span>
<span class="sd">            msg (str or UnboundMsg): message text or instance (default `&quot;{}&quot;`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">UnboundMsg</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">UnboundMsg</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">activate_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">msg_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Activate a message and emit the signal messageActivated</span>

<span class="sd">        Args:</span>
<span class="sd">            msg (_BoundMsg): the message to activate</span>
<span class="sd">            msg_id (int): id for old-style message (to be removed in the future)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">msg</span> <span class="k">if</span> <span class="n">msg_id</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">msg_id</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="n">msg</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">messageActivated</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_active</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">messageActivated</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">deactivate_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deactivate a message and emit the signal messageDeactivated.</span>

<span class="sd">        Args:</span>
<span class="sd">            msg (_BoundMsg): the message to deactivate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">msg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">inst_msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="o">.</span><span class="n">messageDeactivated</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span>
            <span class="n">inst_msg</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">msg</span><span class="p">)</span>

        <span class="c1"># When when we no longer support old-style messages, replace with:</span>
        <span class="c1"># if msg not in self._active:</span>
        <span class="c1">#     return</span>
        <span class="c1"># del self._active[msg]</span>
        <span class="c1"># self.widget.messageDeactivated.emit(msg)</span>

    <span class="c1"># self has default value to avoid PyCharm warnings when calling</span>
    <span class="c1"># self.Error.clear(): PyCharm doesn&#39;t know that Error is instantiated</span>
    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deactivate all active message from this group.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_active</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deactivate_msg</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_general</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_or_text</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">shown</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handler for methods `error`, `warning` and `information`;</span>
<span class="sd">        do not call directly.</span>

<span class="sd">        The message is shown as general message. This method also</span>
<span class="sd">        handles deprecated messages with id&#39;s.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">id_or_text</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">id_or_text</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_general</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">id_or_text</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_general</span><span class="p">(</span><span class="n">id_or_text</span><span class="p">,</span> <span class="n">shown</span><span class="o">=</span><span class="n">shown</span><span class="p">)</span>
        <span class="c1"># remaining cases handle deprecated messages with id&#39;s</span>
        <span class="k">elif</span> <span class="n">text</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activate_msg</span><span class="p">(</span><span class="n">_OldStyleMsg</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="bp">self</span><span class="p">),</span> <span class="n">id_or_text</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">id_or_text</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">msg_id</span> <span class="ow">in</span> <span class="n">id_or_text</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">deactivate_msg</span><span class="p">(</span><span class="n">msg_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">deactivate_msg</span><span class="p">(</span><span class="n">id_or_text</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MessagesMixin</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for message mixins. The class provides a constructor for</span>
<span class="sd">    instantiating and binding message groups.</span>

<span class="sd">    Widgets should use `WidgetMessageMixin rather than this class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># type(self).__dict__ wouldn&#39;t return inherited messages, hence dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_groups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">group_class</span> <span class="o">=</span> <span class="n">getattr_static</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">group_class</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="nb">issubclass</span><span class="p">(</span><span class="n">group_class</span><span class="p">,</span> <span class="n">MessageGroup</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="n">group_class</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">MessageGroup</span><span class="p">:</span>
                <span class="n">bound_group</span> <span class="o">=</span> <span class="n">group_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bound_group</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">message_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bound_group</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_groups</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;severity&quot;</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">WidgetMessagesMixin</span><span class="p">(</span><span class="n">MessagesMixin</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Provide the necessary methods for handling messages in widgets.</span>

<span class="sd">    The class defines member classes `Error`, `Warning` and `Information` that</span>
<span class="sd">    serve as base classes for these message groups.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">class</span> <span class="nc">Error</span><span class="p">(</span><span class="n">MessageGroup</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Base class for groups of error messages in widgets&quot;&quot;&quot;</span>
        <span class="n">severity</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">icon_path</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">resource_filename</span><span class="p">(</span><span class="s2">&quot;icons/error.png&quot;</span><span class="p">)</span>
        <span class="n">bar_background</span> <span class="o">=</span> <span class="s2">&quot;#ffc6c6&quot;</span>
        <span class="n">bar_icon</span> <span class="o">=</span> <span class="n">QStyle</span><span class="o">.</span><span class="n">SP_MessageBoxCritical</span>

    <span class="k">class</span> <span class="nc">Warning</span><span class="p">(</span><span class="n">MessageGroup</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Base class for groups of warning messages in widgets&quot;&quot;&quot;</span>
        <span class="n">severity</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">icon_path</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">resource_filename</span><span class="p">(</span><span class="s2">&quot;icons/warning.png&quot;</span><span class="p">)</span>
        <span class="n">bar_background</span> <span class="o">=</span> <span class="s2">&quot;#ffffc9&quot;</span>
        <span class="n">bar_icon</span> <span class="o">=</span> <span class="n">QStyle</span><span class="o">.</span><span class="n">SP_MessageBoxWarning</span>

    <span class="k">class</span> <span class="nc">Information</span><span class="p">(</span><span class="n">MessageGroup</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Base class for groups of information messages in widgets&quot;&quot;&quot;</span>
        <span class="n">severity</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">icon_path</span> <span class="o">=</span> <span class="n">gui</span><span class="o">.</span><span class="n">resource_filename</span><span class="p">(</span><span class="s2">&quot;icons/information.png&quot;</span><span class="p">)</span>
        <span class="n">bar_background</span> <span class="o">=</span> <span class="s2">&quot;#ceceff&quot;</span>
        <span class="n">bar_icon</span> <span class="o">=</span> <span class="n">QStyle</span><span class="o">.</span><span class="n">SP_MessageBoxInformation</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_bar</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messageActivated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_message_state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messageDeactivated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_message_state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clear_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear all messages&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">message_groups</span><span class="p">:</span>
            <span class="n">group</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update_message_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Show and update (or hide) the content of the widget&#39;s message bar.</span>

<span class="sd">        The method is connected to widget&#39;s signals `messageActivated` and</span>
<span class="sd">        `messageDeactivated`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">message_bar</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message_bar</span><span class="p">,</span> <span class="n">MessagesWidget</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">msg</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
            <span class="c1"># type: (_BoundMsg) -&gt; MessagesWidget.Message</span>
            <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="n">extra</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
                <span class="n">text</span><span class="p">,</span> <span class="n">extra</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">MessagesWidget</span><span class="o">.</span><span class="n">Message</span><span class="p">(</span>
                <span class="n">MessagesWidget</span><span class="o">.</span><span class="n">Severity</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="o">.</span><span class="n">severity</span><span class="p">),</span>
                <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">informativeText</span><span class="o">=</span><span class="n">extra</span><span class="p">,</span>
                <span class="n">detailedText</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">tb</span> <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">tb</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="p">)</span>

        <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">msg</span>
                    <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">message_groups</span>
                    <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">active</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">message_bar</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">messages</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message_bar</span><span class="o">.</span><span class="n">setMessages</span><span class="p">((</span><span class="n">m</span><span class="p">,</span> <span class="n">msg</span><span class="p">(</span><span class="n">m</span><span class="p">))</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_bar</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">messages</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">insert_message_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Insert message bar into the widget.</span>

<span class="sd">        This method must be called at the appropriate place in the widget</span>
<span class="sd">        layout setup by any widget that is using this mixin.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_bar</span> <span class="o">=</span> <span class="n">MessagesWidget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_bar</span><span class="o">.</span><span class="n">setSizePolicy</span><span class="p">(</span><span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Ignored</span><span class="p">,</span> <span class="n">QSizePolicy</span><span class="o">.</span><span class="n">Maximum</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message_bar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_bar</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># pylint doesn&#39;t know that Information, Error and Warning are instantiated</span>
    <span class="c1"># and thus the methods are bound</span>
    <span class="c1"># pylint: disable=no-value-for-parameter</span>
    <span class="c1"># This class and classes Information, Error and Warning are friends</span>
    <span class="c1"># pylint: disable=protected-access</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_warn_obsolete</span><span class="p">(</span><span class="n">text_or_id</span><span class="p">,</span> <span class="n">what</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">text_or_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">text_or_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; with id is deprecated; use </span><span class="si">{}</span><span class="s2"> class&quot;</span><span class="o">.</span>
                 <span class="nb">format</span><span class="p">(</span><span class="n">what</span><span class="p">,</span> <span class="n">what</span><span class="o">.</span><span class="n">title</span><span class="p">()),</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_or_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shown</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_warn_obsolete</span><span class="p">(</span><span class="n">text_or_id</span><span class="p">,</span> <span class="s2">&quot;information&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Information</span><span class="o">.</span><span class="n">_add_general</span><span class="p">(</span><span class="n">text_or_id</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">shown</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">warning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_or_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shown</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_warn_obsolete</span><span class="p">(</span><span class="n">text_or_id</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Warning</span><span class="o">.</span><span class="n">_add_general</span><span class="p">(</span><span class="n">text_or_id</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">shown</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_or_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shown</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_warn_obsolete</span><span class="p">(</span><span class="n">text_or_id</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Error</span><span class="o">.</span><span class="n">_add_general</span><span class="p">(</span><span class="n">text_or_id</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">shown</span><span class="p">)</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">pylost_widgets</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../pylost_widgets.html">pylost_widgets package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.11</a>
      
    </div>

    

    
  </body>
</html>