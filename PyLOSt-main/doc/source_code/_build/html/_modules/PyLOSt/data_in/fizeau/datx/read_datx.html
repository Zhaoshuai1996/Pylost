
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PyLOSt.data_in.fizeau.datx.read_datx &#8212; PyLOSt  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/alabaster.css" />
    <script data-url_root="../../../../../" id="documentation_options" src="../../../../../_static/documentation_options.js"></script>
    <script src="../../../../../_static/jquery.js"></script>
    <script src="../../../../../_static/underscore.js"></script>
    <script src="../../../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for PyLOSt.data_in.fizeau.datx.read_datx</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">filter</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">h5py</span> <span class="k">as</span> <span class="nn">h5</span>


<div class="viewcode-block" id="readDatxFile"><a class="viewcode-back" href="../../../../../PyLOSt.data_in.fizeau.datx.html#PyLOSt.data_in.fizeau.datx.read_datx.readDatxFile">[docs]</a><span class="k">def</span> <span class="nf">readDatxFile</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function reads the binary files (.datx) of HDX.</span>
<span class="sd">    Need to install the modules: numpy, PIL, pandas in the environment.</span>
<span class="sd">    In python3.7, windows10</span>

<span class="sd">    :param FileName: datx file path</span>
<span class="sd">    :return: Raw data as dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">time</span>
    
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1">#read the file</span>
    <span class="k">with</span> <span class="n">h5</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    
        <span class="c1">#GroupNames = [n for n in f.keys()]</span>
        
        <span class="n">Attributes</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Attributes&#39;</span><span class="p">]</span>
        <span class="n">Attrs_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">Attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">Att</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">Attrs_keys</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
        
        <span class="n">Dset</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span>
        
        <span class="c1">#print(Dset.keys())</span>
        
        <span class="k">if</span> <span class="s1">&#39;Intensity&#39;</span> <span class="ow">in</span> <span class="n">Dset</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
            <span class="n">IntensityDatasetNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">Dset</span><span class="p">[</span><span class="s1">&#39;Intensity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
            <span class="n">Intensity</span> <span class="o">=</span> <span class="n">Dset</span><span class="p">[</span><span class="s1">&#39;Intensity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">IntensityDatasetNames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Intensity_Attr_meta</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Intensity</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
            <span class="c1">#print(Intensity_Attr_meta)</span>
        
        <span class="n">SurfaceDatasetNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">Dset</span><span class="p">[</span><span class="s1">&#39;Surface&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">Surface</span> <span class="o">=</span> <span class="n">Dset</span><span class="p">[</span><span class="s1">&#39;Surface&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SurfaceDatasetNames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Surface_Attr_meta</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Surface</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
        
        <span class="n">SurfaceNoDataPixelValue</span> <span class="o">=</span> <span class="n">Surface_Attr_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;No Data&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;camera_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">Att</span><span class="p">[</span><span class="s1">&#39;Data Context.Data Attributes.Camera Width:Value&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),)</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;camera_height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">Att</span><span class="p">[</span><span class="s1">&#39;Data Context.Data Attributes.Camera Height:Value&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),)</span>
        
        
        <span class="c1">#Intensity file</span>
        <span class="k">if</span> <span class="s1">&#39;Intensity&#39;</span> <span class="ow">in</span> <span class="n">Dset</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> 
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;ac_org_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Intensity_Attr_meta</span><span class="p">[</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;ac_org_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Intensity_Attr_meta</span><span class="p">[</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;ac_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Intensity_Attr_meta</span><span class="p">[</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;ac_height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Intensity_Attr_meta</span><span class="p">[</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">IntensityNoDataPixelValue</span> <span class="o">=</span> <span class="n">Intensity_Attr_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;No Data&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;data_intensity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Intensity</span><span class="p">)</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;data_intensity&#39;</span><span class="p">][</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data_intensity&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">IntensityNoDataPixelValue</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;data_intensity&#39;</span><span class="p">][</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data_intensity&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;data_intensity&#39;</span><span class="p">][</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data_intensity&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">256</span>
            <span class="c1">#d[&#39;data_intensity&#39;] =np.reshape(d[&#39;data_intensity&#39;],(d[&#39;ac_height&#39;],d[&#39;ac_width&#39;]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;ac_org_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;ac_org_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;ac_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;ac_height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;data_intensity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;intf_scale_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Att</span><span class="p">[</span><span class="s1">&#39;Data Context.Data Attributes.Interf Scale Factor:Value&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;wavelength_in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Att</span><span class="p">[</span><span class="s1">&#39;Data Context.Data Attributes.Wavelength:Value&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;obliquity_factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Surface_Attr_meta</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;Z Converter&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;magnification&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Att</span><span class="p">[</span><span class="s1">&#39;Data Context.Data Attributes.Encoded Zoom Custom Magnification:Value&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;CameraRes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Att</span><span class="p">[</span><span class="s1">&#39;Surface Data Context.Lateral Resolution:Value&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="c1"># Att[&#39;Data Context.Lateral Resolution:Value&#39;][0]</span>
        
        <span class="c1">#Phase Data Matrix</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;cn_org_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Surface_Attr_meta</span><span class="p">[</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;cn_org_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Surface_Attr_meta</span><span class="p">[</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;cn_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Surface_Attr_meta</span><span class="p">[</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;cn_height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Surface_Attr_meta</span><span class="p">[</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;data_pixel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Surface</span><span class="p">)</span>
        <span class="c1">#d[&#39;data_pixel&#39;] = np.reshape(d[&#39;data_pixel&#39;], [d[&#39;cn_height&#39;], d[&#39;cn_width&#39;]])</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;data_pixel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;data_pixel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
        
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">]</span>       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data_pixel&#39;</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;bool&#39;</span><span class="p">)</span>
        
        
       <span class="c1"># for i in range(0,d[&#39;cn_height&#39;]):</span>
       <span class="c1">#     for j in range(0,d[&#39;cn_width&#39;]):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data_pixel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;data_pixel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;data_pixel&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">SurfaceNoDataPixelValue</span><span class="p">:</span><span class="c1">#2017151:#2097151</span>
                    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;data_pixel&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">elif</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;data_pixel&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="n">SurfaceNoDataPixelValue</span><span class="p">:</span><span class="c1">#2017152:#2097152</span>
                    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;data_pixel&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">pass</span>



        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;intf_scale_factor&#39;</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;wavelength_in&#39;</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;obliquity_factor&#39;</span><span class="p">]</span>

        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;number_of_points_phase&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;cn_width&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;cn_height&#39;</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;waves&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;data_pixel&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;meters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;data_pixel&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">]</span>

        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;height_nm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;meters&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">1e+9</span>

        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;date_measurement&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Att</span><span class="p">[</span><span class="s1">&#39;Data Context.Data Attributes.Time Stamp&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;number_day&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;date_measurement&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;date_measurement&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;number_day&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;hour_mesurement&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;hour_mesurement&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;minute_mesurement&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">60</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;minute_mesurement&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">60</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;second_mesurement&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;time_format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;date_measurement&#39;</span><span class="p">])</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;date_str&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;date_measurement&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;date_datToOpd&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;time_format&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;time_datToOpd&#39;</span><span class="p">]</span> <span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;time_format&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span>


        <span class="c1">#np.savetxt(&quot;meters_dat.txt&quot;,meters)</span>
        <span class="c1"># Save a txt file in the same Folder with the code, the file shows height(meter) of every pixel, open it with Notepad, otherwise it changes the shape of the matrix.</span>

        <span class="c1">#np.savetxt(&quot;data_pixel_dat.txt&quot;,data_pixel)</span>
        <span class="c1"># Save a txt file in the same Folder with the code, the file shows phase value(more information of phase data is in the official instruction) of every pixel, open it with Notepad, otherwise it changes the shape of the matrix.        </span>

        <span class="c1">#np.savetxt(&quot;intensity_dat.txt&quot;,data_intensity)</span>
        <span class="c1"># Save a txt file in the same Folder with the code, the file shows intensity value(more information of intensity data is in the official instruction) of every pixel, open it with Notepad, otherwise it changes the shape of the matrix.        </span>


        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Max_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;height_nm&#39;</span><span class="p">])</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;Min_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;height_nm&#39;</span><span class="p">])</span>
        
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
    <span class="k">try</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fileName</span><span class="p">)[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">fileName</span><span class="p">)[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">split_name</span> <span class="o">=</span> <span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-P&#39;</span><span class="p">)</span>
        <span class="n">aux_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split_name</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">split_name</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="p">:</span>
                    <span class="n">aux_name</span> <span class="o">=</span> <span class="n">split_name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">aux_name</span> <span class="o">=</span> <span class="n">aux_name</span> <span class="o">+</span> <span class="s1">&#39;-P&#39;</span> <span class="o">+</span> <span class="n">split_name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aux_name</span> <span class="o">=</span> <span class="n">split_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> 

        <span class="n">motor_df_path</span> <span class="o">=</span> <span class="n">aux_name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;data.csv&#39;</span>
        <span class="n">sub_aperture_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">file_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-P&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:])</span>
        <span class="n">motor_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span> <span class="o">+</span> <span class="s1">&#39;//&#39;</span> <span class="o">+</span> <span class="n">motor_df_path</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;motorX&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">motor_df</span><span class="p">[</span><span class="n">motor_df</span><span class="p">[</span><span class="s1">&#39;Step_Count_X&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sub_aperture_number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Motor_X_Pos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;motorRx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">motor_df</span><span class="p">[</span><span class="n">motor_df</span><span class="p">[</span><span class="s1">&#39;Step_Count_X&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sub_aperture_number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Motor_ROLL_Pos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;motorRy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">motor_df</span><span class="p">[</span><span class="n">motor_df</span><span class="p">[</span><span class="s1">&#39;Step_Count_X&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">sub_aperture_number</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="s1">&#39;Motor_PITCH_Pos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Motor df &lt;- readDatx (Fizeau)&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="readDatxMatrixSize"><a class="viewcode-back" href="../../../../../PyLOSt.data_in.fizeau.datx.html#PyLOSt.data_in.fizeau.datx.read_datx.readDatxMatrixSize">[docs]</a><span class="k">def</span> <span class="nf">readDatxMatrixSize</span><span class="p">(</span><span class="n">fileName</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function reads the binary files (.datx) of HDX and returns the size of the data matrix size.</span>
<span class="sd">    Need to install the modules: numpy, PIL in the environment.</span>
<span class="sd">    In python3.7, windows10</span>

<span class="sd">    :param FileName: datx file path</span>
<span class="sd">    :return: Raw data size as dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1">#read the file</span>
    <span class="k">with</span> <span class="n">h5</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    
        <span class="c1">#GroupNames = [n for n in f.keys()]</span>
        
        <span class="c1">#Attributes = f[&#39;Attributes&#39;]</span>
        <span class="c1">#Attrs_keys = [n for n in Attributes.keys()]</span>
        <span class="c1">#Att = dict(Attributes.get(Attrs_keys[1]).attrs)</span>
        
        <span class="n">Dset</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;Data&#39;</span><span class="p">]</span>
        
        <span class="c1">#print(Dset.keys())</span>
        
        <span class="n">SurfaceDatasetNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">Dset</span><span class="p">[</span><span class="s1">&#39;Surface&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
        <span class="n">Surface</span> <span class="o">=</span> <span class="n">Dset</span><span class="p">[</span><span class="s1">&#39;Surface&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SurfaceDatasetNames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Surface_Attr_meta</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">Surface</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>
        
        <span class="c1">#Phase Data Matrix</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;cn_org_x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Surface_Attr_meta</span><span class="p">[</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;cn_org_y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Surface_Attr_meta</span><span class="p">[</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;cn_width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Surface_Attr_meta</span><span class="p">[</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">d</span><span class="p">[</span><span class="s1">&#39;cn_height&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Surface_Attr_meta</span><span class="p">[</span><span class="s1">&#39;Coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
    <span class="k">return</span> <span class="n">d</span></div>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">import</span> <span class="n">imshow</span><span class="p">,</span> <span class="n">show</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">readDatxFile</span><span class="p">(</span><span class="s1">&#39;X:\Fizeau data\MoonPics\silja\help</span><span class="se">\\</span><span class="s1">updates_24_03_2020\mirror\I1-P1.datx&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
        <span class="c1"># d=(readDatFile(&#39;X:\Fizeau data\MoonPics\sphere\AB-SPH-ST2\Ref-subtracted\Ref_sub-HZB-AB-Sph-ST2-R1-P&#39;+str(i)+&#39;.dat&#39;))</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">!=</span><span class="s1">&#39;data_point&#39;</span><span class="p">:</span>        <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">imshow</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;height_nm&#39;</span><span class="p">])</span>
    <span class="n">show</span><span class="p">()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../../index.html">PyLOSt</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../PyLOSt.html">PyLOSt package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../quick_guide.html">Quick Guide</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>